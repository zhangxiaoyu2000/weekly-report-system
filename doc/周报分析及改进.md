# å‘¨æŠ¥æäº¤å’Œå®¡æ‰¹æµç¨‹åˆ†æåŠæ”¹è¿›æ–¹æ¡ˆ

## 1. å½“å‰å‘¨æŠ¥æµç¨‹åˆ†æ

### 1.1 ç°æœ‰å‘¨æŠ¥çŠ¶æ€æµè½¬

**WeeklyReport.ReportStatus æšä¸¾åˆ†æï¼š**
```java
DRAFT â†’ SUBMITTED â†’ PENDING_MGR_REVIEW â†’ MANAGER_REJECTED
                  â†’ PENDING_AI_ANALYSIS â†’ AI_REJECTED
                  â†’ PENDING_ADMIN_REVIEW â†’ ADMIN_REJECTED  
                  â†’ PENDING_SA_REVIEW â†’ SUPER_ADMIN_REJECTED
                  â†’ APPROVED
```

**ç°æœ‰çŠ¶æ€è¯´æ˜ï¼š**
- `DRAFT` - è‰ç¨¿çŠ¶æ€
- `SUBMITTED` - å·²æäº¤
- `PENDING_MGR_REVIEW` - å¾…ä¸»ç®¡å®¡æ ¸
- `MANAGER_REJECTED` - ä¸»ç®¡æ‹’ç»
- `PENDING_AI_ANALYSIS` - å¾…AIåˆ†æ
- `AI_REJECTED` - AIä¸åˆæ ¼
- `PENDING_ADMIN_REVIEW` - å¾…ç®¡ç†å‘˜å®¡æ ¸
- `ADMIN_REJECTED` - ç®¡ç†å‘˜æ‹’ç»
- `PENDING_SA_REVIEW` - å¾…è¶…çº§ç®¡ç†å‘˜å®¡æ ¸
- `SUPER_ADMIN_REJECTED` - è¶…çº§ç®¡ç†å‘˜æ‹’ç»
- `APPROVED` - æœ€ç»ˆæ‰¹å‡†
- `REVISION_REQUESTED` - éœ€è¦ä¿®æ”¹
- `ARCHIVED` - å·²å½’æ¡£

### 1.2 ç°æœ‰å‘¨æŠ¥å®ä½“ç»“æ„åˆ†æ

**ä¼˜åŠ¿ï¼š**
- âœ… **åŸºç¡€å­—æ®µå®Œæ•´**: title, content, reportWeekç­‰
- âœ… **è¯¦ç»†å†…å®¹åˆ†æ®µ**: workSummary, achievements, challenges, nextWeekPlan
- âœ… **å®¡æ ¸æ”¯æŒ**: reviewComment, reviewedAt, submittedAt
- âœ… **å¤šçŠ¶æ€æ”¯æŒ**: 13ç§çŠ¶æ€è¦†ç›–å®Œæ•´æµç¨‹

**ä¸è¶³ï¼š**
- âŒ **ç¼ºå°‘ä¸‰çº§å®¡æ‰¹å­—æ®µ**: æ²¡æœ‰åˆ†åˆ«çš„ä¸»ç®¡ã€ç®¡ç†å‘˜ã€è¶…çº§ç®¡ç†å‘˜å®¡æ ¸ä¿¡æ¯
- âŒ **ç¼ºå°‘AIåˆ†æå­—æ®µ**: æ²¡æœ‰AIåˆ†æç»“æœã€ç½®ä¿¡åº¦ç­‰å­—æ®µ
- âŒ **ç¼ºå°‘å®¡æ ¸å†å²**: æ— æ³•è¿½è¸ªå¤šçº§å®¡æ ¸çš„å†å²è®°å½•

## 2. é¡¹ç›®å®¡æ‰¹æµç¨‹å¯¹æ¯”åˆ†æ

### 2.1 é¡¹ç›®å®¡æ‰¹æµç¨‹ä¼˜åŠ¿

**SimpleProject.ProjectStatus æµç¨‹ï¼š**
```java
PENDING_AI_ANALYSIS â†’ AI_REJECTED (å¯ä¿®æ”¹é‡æ–°æäº¤)
                   â†’ PENDING_ADMIN_REVIEW â†’ ADMIN_REJECTED (å¯ä¿®æ”¹é‡æ–°æäº¤)
                   â†’ PENDING_SUPER_ADMIN_REVIEW â†’ SUPER_ADMIN_REJECTED (å¯ä¿®æ”¹é‡æ–°æäº¤)
                   â†’ APPROVED
```

**é¡¹ç›®å®¡æ‰¹çš„å…ˆè¿›ç‰¹æ€§ï¼š**
1. **âœ… DeepSeek AIé›†æˆ**: è‡ªåŠ¨AIåˆ†æé¡¹ç›®å¯è¡Œæ€§
2. **âœ… ä¸‰çº§å®¡æ‰¹å­—æ®µ**: 
   - `managerReviewer`, `managerReviewComment`, `managerReviewedAt`
   - `adminReviewer`, `adminReviewComment`, `adminReviewedAt`
   - `superAdminReviewer`, `superAdminReviewComment`, `superAdminReviewedAt`
3. **âœ… å®Œæ•´AIåˆ†æè®°å½•**:
   - `aiAnalysisResult`, `aiConfidence`, `aiFeasibilityScore`
   - `aiRiskLevel`, `aiProviderUsed`, `aiProcessingTimeMs`
   - `aiAnalyzedAt`, `aiKeyIssues`, `aiRecommendations`
4. **âœ… é‡æ–°æäº¤åŠŸèƒ½**: è¢«æ‹’ç»åå¯ä¿®æ”¹é‡æ–°æäº¤
5. **âœ… å¼ºè¡Œæäº¤åŠŸèƒ½**: ä¸»ç®¡å¯å¼ºè¡Œæäº¤è·³è¿‡AIåˆ†æ

### 2.2 å‘¨æŠ¥æµç¨‹ç¼ºå¤±çš„åŠŸèƒ½

**å¯¹æ¯”é¡¹ç›®æµç¨‹ï¼Œå‘¨æŠ¥ç¼ºå°‘ï¼š**
1. **âŒ AIè´¨é‡åˆ†æ**: æ²¡æœ‰é›†æˆAIåˆ†æå‘¨æŠ¥è´¨é‡
2. **âŒ åˆ†çº§å®¡æ ¸å­—æ®µ**: æ··ç”¨å•ä¸€reviewerå­—æ®µ
3. **âŒ é‡æ–°æäº¤æœºåˆ¶**: è¢«æ‹’ç»åæ— æ³•ä¿®æ”¹é‡æ–°æäº¤
4. **âŒ å¼ºè¡Œæäº¤åŠŸèƒ½**: æ— æ³•è·³è¿‡æŸäº›å®¡æ‰¹ç¯èŠ‚
5. **âŒ è¯¦ç»†å®¡æ ¸å†å²**: æ— æ³•è¿½è¸ªå®Œæ•´çš„å®¡æ‰¹è¿‡ç¨‹

## 3. å‰ç«¯ç»„ä»¶åˆ†æ

### 3.1 å‘¨æŠ¥ç®¡ç†ç›¸å…³ç»„ä»¶

**ç°æœ‰ç»„ä»¶ï¼š**
- `CreateReportView.vue` - åˆ›å»ºå‘¨æŠ¥
- `EditReportView.vue` - ç¼–è¾‘å‘¨æŠ¥
- `ReportsView.vue` - å‘¨æŠ¥åˆ—è¡¨
- `ReportDetailView.vue` - å‘¨æŠ¥è¯¦æƒ…
- `AdminReportsView.vue` - ç®¡ç†å‘˜å‘¨æŠ¥ç®¡ç†
- `ReviewReportsView.vue` - å®¡æ ¸å‘¨æŠ¥
- `SuperAdminReportsView.vue` - è¶…çº§ç®¡ç†å‘˜å‘¨æŠ¥ç®¡ç†

### 3.2 å‰ç«¯åŠŸèƒ½åˆ†æ

**ä¼˜åŠ¿ï¼š**
- âœ… **ä»»åŠ¡ç³»ç»Ÿé›†æˆ**: CreateReportViewé›†æˆäº†TaskFormç»„ä»¶
- âœ… **Markdownæ¸²æŸ“**: ReviewReportsViewæ”¯æŒMarkdownæ˜¾ç¤º
- âœ… **å¤šè§’è‰²è§†å›¾**: ä¸åŒè§’è‰²æœ‰ä¸“é—¨çš„ç®¡ç†ç•Œé¢

**ä¸è¶³ï¼š**
- âŒ **ç¼ºå°‘AIåˆ†ææ˜¾ç¤º**: æ²¡æœ‰AIè´¨é‡è¯„ä¼°ç•Œé¢
- âŒ **ç¼ºå°‘é‡æ–°æäº¤åŠŸèƒ½**: è¢«æ‹’ç»åæ— æ³•ä¿®æ”¹
- âŒ **å®¡æ ¸å†å²ç®€å•**: æ²¡æœ‰å®Œæ•´çš„ä¸‰çº§å®¡æ‰¹æ˜¾ç¤º
- âŒ **çŠ¶æ€æµè½¬ä¸æ¸…æ™°**: ç¼ºå°‘é¡¹ç›®çº§åˆ«çš„çŠ¶æ€å¯è§†åŒ–

## 4. åç«¯APIå’Œä¸šåŠ¡é€»è¾‘åˆ†æ

### 4.1 ç°æœ‰APIç«¯ç‚¹åˆ†æ

**WeeklyReportController ä¸»è¦ç«¯ç‚¹ï¼š**
- `POST /api/reports` - åˆ›å»ºå‘¨æŠ¥
- `PUT /api/reports/{id}` - æ›´æ–°å‘¨æŠ¥
- `POST /api/reports/{id}/submit` - æäº¤å‘¨æŠ¥
- `POST /api/reports/{id}/review` - å®¡æ ¸å‘¨æŠ¥
- `GET /api/reports` - è·å–å‘¨æŠ¥åˆ—è¡¨
- `GET /api/reports/{id}` - è·å–å‘¨æŠ¥è¯¦æƒ…

### 4.2 ä¸šåŠ¡é€»è¾‘åˆ†æ

**ä¼˜åŠ¿ï¼š**
- âœ… **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- âœ… **çŠ¶æ€ç®¡ç†**: å®Œæ•´çš„çŠ¶æ€æµè½¬é€»è¾‘
- âœ… **å®¡æ ¸åŠŸèƒ½**: æ”¯æŒå®¡æ ¸å’Œæ‹’ç»

**ä¸è¶³ï¼š**
- âŒ **ç¼ºå°‘AIåˆ†æé›†æˆ**: æ²¡æœ‰è°ƒç”¨AIæœåŠ¡åˆ†æå‘¨æŠ¥è´¨é‡
- âŒ **å•ä¸€å®¡æ ¸å­—æ®µ**: åªæœ‰ä¸€ä¸ªreviewerï¼Œæ— æ³•è®°å½•å¤šçº§å®¡æ ¸
- âŒ **ç¼ºå°‘é‡æ–°æäº¤API**: æ²¡æœ‰resubmitç«¯ç‚¹
- âŒ **ç¼ºå°‘å¼ºè¡Œæäº¤API**: æ²¡æœ‰force-submitåŠŸèƒ½

## 5. å…³é”®é—®é¢˜è¯†åˆ«

### 5.1 æ¶æ„å·®å¼‚å¯¹æ¯”

| åŠŸèƒ½ç‰¹æ€§ | é¡¹ç›®å®¡æ‰¹ | å‘¨æŠ¥å®¡æ‰¹ | æ”¹è¿›éœ€æ±‚ |
|---------|---------|---------|---------|
| AIåˆ†æé›†æˆ | âœ… DeepSeek | âŒ æ—  | é«˜ä¼˜å…ˆçº§ |
| ä¸‰çº§å®¡æ‰¹å­—æ®µ | âœ… å®Œæ•´ | âŒ å•ä¸€ | é«˜ä¼˜å…ˆçº§ |
| é‡æ–°æäº¤ | âœ… æ”¯æŒ | âŒ æ—  | ä¸­ä¼˜å…ˆçº§ |
| å¼ºè¡Œæäº¤ | âœ… æ”¯æŒ | âŒ æ—  | ä¸­ä¼˜å…ˆçº§ |
| å®¡æ ¸å†å² | âœ… è¯¦ç»† | âŒ ç®€å• | ä¸­ä¼˜å…ˆçº§ |
| çŠ¶æ€å¯è§†åŒ– | âœ… æ¸…æ™° | âŒ åŸºç¡€ | ä½ä¼˜å…ˆçº§ |

### 5.2 æ•°æ®ç»“æ„å·®å¼‚

**é¡¹ç›®å®ä½“ vs å‘¨æŠ¥å®ä½“ï¼š**

| å­—æ®µç±»å‹ | SimpleProject | WeeklyReport | éœ€è¦æ·»åŠ  |
|---------|---------------|--------------|----------|
| AIåˆ†æç»“æœ | aiAnalysisResult | âŒ | âœ… |
| AIç½®ä¿¡åº¦ | aiConfidence | âŒ | âœ… |
| AIé£é™©ç­‰çº§ | aiRiskLevel | âŒ | âœ… |
| ä¸»ç®¡å®¡æ ¸äºº | managerReviewer | âŒ | âœ… |
| ç®¡ç†å‘˜å®¡æ ¸äºº | adminReviewer | reviewer | ğŸ”„ é‡æ„ |
| è¶…ç®¡å®¡æ ¸äºº | superAdminReviewer | âŒ | âœ… |
| å®¡æ ¸è¯„è®ºåˆ†ç¦» | ä¸‰å¥—commentå­—æ®µ | å•ä¸€comment | ğŸ”„ é‡æ„ |

## 6. æ”¹è¿›æªæ–½å’Œå®æ–½æ–¹æ¡ˆ

### 6.1 æ•°æ®åº“ç»“æ„æ”¹è¿›

**éœ€è¦æ·»åŠ åˆ°WeeklyReportè¡¨çš„å­—æ®µï¼š**

```sql
-- AIåˆ†æç›¸å…³å­—æ®µ
ALTER TABLE weekly_reports ADD COLUMN ai_analysis_result TEXT;
ALTER TABLE weekly_reports ADD COLUMN ai_confidence DECIMAL(3,2);
ALTER TABLE weekly_reports ADD COLUMN ai_quality_score DECIMAL(3,2);
ALTER TABLE weekly_reports ADD COLUMN ai_risk_level VARCHAR(20);
ALTER TABLE weekly_reports ADD COLUMN ai_provider_used VARCHAR(50);
ALTER TABLE weekly_reports ADD COLUMN ai_processing_time_ms BIGINT;
ALTER TABLE weekly_reports ADD COLUMN ai_analyzed_at TIMESTAMP;
ALTER TABLE weekly_reports ADD COLUMN ai_key_issues JSON;
ALTER TABLE weekly_reports ADD COLUMN ai_recommendations JSON;

-- ä¸‰çº§å®¡æ‰¹å­—æ®µ
ALTER TABLE weekly_reports ADD COLUMN manager_reviewer_id BIGINT;
ALTER TABLE weekly_reports ADD COLUMN manager_review_comment TEXT;
ALTER TABLE weekly_reports ADD COLUMN manager_reviewed_at TIMESTAMP;

-- é‡æ„ç°æœ‰å®¡æ ¸å­—æ®µä¸ºç®¡ç†å‘˜å®¡æ ¸
ALTER TABLE weekly_reports RENAME COLUMN reviewer_id TO admin_reviewer_id;
ALTER TABLE weekly_reports RENAME COLUMN review_comment TO admin_review_comment;
ALTER TABLE weekly_reports RENAME COLUMN reviewed_at TO admin_reviewed_at;

-- è¶…çº§ç®¡ç†å‘˜å®¡æ ¸å­—æ®µ
ALTER TABLE weekly_reports ADD COLUMN super_admin_reviewer_id BIGINT;
ALTER TABLE weekly_reports ADD COLUMN super_admin_review_comment TEXT;
ALTER TABLE weekly_reports ADD COLUMN super_admin_reviewed_at TIMESTAMP;

-- å¤–é”®çº¦æŸ
ALTER TABLE weekly_reports ADD FOREIGN KEY (manager_reviewer_id) REFERENCES users(id);
ALTER TABLE weekly_reports ADD FOREIGN KEY (admin_reviewer_id) REFERENCES users(id);
ALTER TABLE weekly_reports ADD FOREIGN KEY (super_admin_reviewer_id) REFERENCES users(id);
```

### 6.2 åç«¯APIæ‰©å±•

**éœ€è¦æ·»åŠ çš„APIç«¯ç‚¹ï¼š**

1. **AIåˆ†æç›¸å…³**ï¼š
   ```java
   POST /api/reports/{id}/ai-analysis  // è§¦å‘AIè´¨é‡åˆ†æ
   GET /api/reports/{id}/ai-result     // è·å–AIåˆ†æç»“æœ
   ```

2. **é‡æ–°æäº¤åŠŸèƒ½**ï¼š
   ```java
   PUT /api/reports/{id}/resubmit      // é‡æ–°æäº¤å‘¨æŠ¥
   POST /api/reports/{id}/force-submit  // å¼ºè¡Œæäº¤å‘¨æŠ¥
   ```

3. **åˆ†çº§å®¡æ ¸åŠŸèƒ½**ï¼š
   ```java
   POST /api/reports/{id}/manager-review    // ä¸»ç®¡å®¡æ ¸
   POST /api/reports/{id}/admin-review      // ç®¡ç†å‘˜å®¡æ ¸  
   POST /api/reports/{id}/superadmin-review // è¶…çº§ç®¡ç†å‘˜å®¡æ ¸
   ```

### 6.3 ä¸šåŠ¡é€»è¾‘æ”¹è¿›

**æ–°çš„å‘¨æŠ¥å®¡æ‰¹æµç¨‹è®¾è®¡ï¼š**

```
ç”¨æˆ·åˆ›å»º â†’ DRAFT
ç”¨æˆ·æäº¤ â†’ SUBMITTED â†’ PENDING_AI_ANALYSIS
AIåˆ†æé€šè¿‡ â†’ PENDING_MGR_REVIEW  
AIåˆ†æä¸é€šè¿‡ â†’ AI_REJECTED (å¯é‡æ–°æäº¤)
ä¸»ç®¡å®¡æ ¸é€šè¿‡ â†’ PENDING_ADMIN_REVIEW
ä¸»ç®¡å®¡æ ¸æ‹’ç» â†’ MANAGER_REJECTED (å¯é‡æ–°æäº¤)
ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡ â†’ PENDING_SA_REVIEW
ç®¡ç†å‘˜å®¡æ ¸æ‹’ç» â†’ ADMIN_REJECTED (å¯é‡æ–°æäº¤)
è¶…çº§ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡ â†’ APPROVED
è¶…çº§ç®¡ç†å‘˜å®¡æ ¸æ‹’ç» â†’ SUPER_ADMIN_REJECTED (å¯é‡æ–°æäº¤)
```

**AIåˆ†æé›†æˆæ–¹æ¡ˆï¼š**
1. **åˆ†æç»´åº¦**ï¼š
   - å†…å®¹å®Œæ•´æ€§å’Œè¯¦ç»†ç¨‹åº¦
   - å·¥ä½œæˆæœçš„å…·ä½“æ€§å’Œå¯è¡¡é‡æ€§
   - é—®é¢˜è¯†åˆ«çš„å‡†ç¡®æ€§å’Œæ·±åº¦
   - ä¸‹å‘¨è®¡åˆ’çš„å¯æ‰§è¡Œæ€§
   - æ•´ä½“è¡¨è¾¾çš„ä¸“ä¸šæ€§

2. **AIæç¤ºè¯è®¾è®¡**ï¼š
   ```
   åˆ†æä»¥ä¸‹å‘¨æŠ¥çš„è´¨é‡ï¼š
   - æ ‡é¢˜ï¼š{title}
   - å·¥ä½œæ€»ç»“ï¼š{workSummary}
   - ä¸»è¦æˆæœï¼š{achievements}
   - é‡åˆ°çš„æŒ‘æˆ˜ï¼š{challenges}
   - ä¸‹å‘¨è®¡åˆ’ï¼š{nextWeekPlan}
   - å…¶ä»–å¤‡æ³¨ï¼š{additionalNotes}
   
   è¿”å›JSONæ ¼å¼ç»“æœï¼š
   {
     "isPass": true/false,
     "proposal": "è¯¦ç»†è¯„ä¼°æ„è§",
     "qualityScore": 0.0-1.0,
     "riskLevel": "LOW/MEDIUM/HIGH",
     "keyIssues": [...],
     "recommendations": [...]
   }
   ```

### 6.4 å‰ç«¯ç•Œé¢æ”¹è¿›

**éœ€è¦æ–°å¢çš„ç»„ä»¶ï¼š**

1. **å‘¨æŠ¥ç¼–è¾‘é¡µé¢** (`EditReportView.vue`):
   - å‚è€ƒ `EditProjectView.vue` è®¾è®¡
   - æ”¯æŒä¿®æ”¹åé‡æ–°æäº¤
   - æ˜¾ç¤ºAIåˆ†æåé¦ˆ
   - æ”¯æŒå¼ºè¡Œæäº¤åŠŸèƒ½

2. **å‘¨æŠ¥å®¡æ ¸å¢å¼º** (`ReviewReportsView.vue`):
   - æ·»åŠ AIåˆ†æç»“æœæ˜¾ç¤º
   - ä¸‰çº§å®¡æ‰¹è¿›åº¦æ¡
   - å®¡æ ¸å†å²æ—¶é—´è½´
   - Markdownå†…å®¹æ¸²æŸ“

3. **å‘¨æŠ¥è¯¦æƒ…å¢å¼º** (`ReportDetailView.vue`):
   - AIåˆ†æç»“æœå±•ç¤º
   - å®Œæ•´å®¡æ‰¹å†å²
   - é‡æ–°æäº¤å’Œå¼ºè¡Œæäº¤æŒ‰é’®

### 6.5 æƒé™å’Œå®‰å…¨æ”¹è¿›

**æƒé™æ§åˆ¶ä¼˜åŒ–ï¼š**
```java
// ä¸»ç®¡å®¡æ ¸æƒé™
@PreAuthorize("hasRole('MANAGER')")
public void managerReviewReport(Long reportId, boolean approved, String comment)

// AIåˆ†ææƒé™ï¼ˆç³»ç»Ÿå†…éƒ¨è°ƒç”¨ï¼‰
public void triggerAIAnalysis(WeeklyReport report)

// é‡æ–°æäº¤æƒé™ï¼ˆæŠ¥å‘Šä½œè€…ï¼‰
@PreAuthorize("@weeklyReportSecurity.canUserResubmitReport(#reportId, authentication.name)")
public void resubmitReport(Long reportId, WeeklyReportUpdateRequest request)
```

## 7. å®æ–½ä¼˜å…ˆçº§å’Œæ—¶é—´è§„åˆ’

### 7.1 é«˜ä¼˜å…ˆçº§æ”¹è¿›ï¼ˆç¬¬ä¸€é˜¶æ®µ - 2å‘¨ï¼‰

1. **AIåˆ†æé›†æˆ**ï¼š
   - æ·»åŠ AIåˆ†æå­—æ®µåˆ°WeeklyReportå®ä½“
   - é›†æˆDeepSeek AIæœåŠ¡åˆ°å‘¨æŠ¥å®¡æ‰¹æµç¨‹
   - å®ç°å‘¨æŠ¥è´¨é‡åˆ†æåŠŸèƒ½

2. **ä¸‰çº§å®¡æ‰¹å­—æ®µ**ï¼š
   - æ•°æ®åº“è¡¨ç»“æ„å‡çº§
   - å®ä½“ç±»å­—æ®µæ‰©å±•
   - APIæ¥å£å‡çº§

### 7.2 ä¸­ä¼˜å…ˆçº§æ”¹è¿›ï¼ˆç¬¬äºŒé˜¶æ®µ - 1å‘¨ï¼‰

1. **é‡æ–°æäº¤åŠŸèƒ½**ï¼š
   - åç«¯APIå¼€å‘
   - å‰ç«¯ç¼–è¾‘é¡µé¢
   - çŠ¶æ€æµè½¬é€»è¾‘

2. **å®¡æ ¸ç•Œé¢ä¼˜åŒ–**ï¼š
   - AIåˆ†æç»“æœæ˜¾ç¤º
   - å®¡æ ¸å†å²å¢å¼º
   - çŠ¶æ€å¯è§†åŒ–

### 7.3 ä½ä¼˜å…ˆçº§æ”¹è¿›ï¼ˆç¬¬ä¸‰é˜¶æ®µ - 1å‘¨ï¼‰

1. **å¼ºè¡Œæäº¤åŠŸèƒ½**
2. **é«˜çº§æœç´¢å’Œç­›é€‰**
3. **æŠ¥è¡¨å’Œç»Ÿè®¡åŠŸèƒ½**

## 8. é£é™©è¯„ä¼°å’Œæ³¨æ„äº‹é¡¹

### 8.1 æŠ€æœ¯é£é™©

1. **æ•°æ®åº“è¿ç§»é£é™©**ï¼š
   - å¤§é‡å­—æ®µå˜æ›´å¯èƒ½å½±å“ç°æœ‰æ•°æ®
   - éœ€è¦ç¼–å†™æ•°æ®è¿ç§»è„šæœ¬
   - å»ºè®®åˆ†é˜¶æ®µå®æ–½

2. **AIåˆ†ææ€§èƒ½**ï¼š
   - å‘¨æŠ¥åˆ†æå¯èƒ½è€—æ—¶è¾ƒé•¿
   - éœ€è¦å¼‚æ­¥å¤„ç†æœºåˆ¶
   - è€ƒè™‘æ‰¹å¤„ç†å’Œç¼“å­˜ç­–ç•¥

3. **å‘åå…¼å®¹æ€§**ï¼š
   - ç°æœ‰APIå¯èƒ½è¢«å‰ç«¯è°ƒç”¨
   - éœ€è¦ç»´æŠ¤æ—§æ¥å£ä¸€æ®µæ—¶é—´
   - é€æ­¥åºŸå¼ƒè¿‡æ¸¡

### 8.2 ä¸šåŠ¡é£é™©

1. **ç”¨æˆ·ä¹ æƒ¯æ”¹å˜**ï¼š
   - æ–°æµç¨‹å¯èƒ½éœ€è¦ç”¨æˆ·åŸ¹è®­
   - å®¡æ‰¹æ—¶é—´å¯èƒ½å»¶é•¿
   - éœ€è¦æ¸è¿›å¼æ¨å¹¿

2. **å®¡æ‰¹æ•ˆç‡**ï¼š
   - ä¸‰çº§å®¡æ‰¹å¯èƒ½é™ä½æ•ˆç‡
   - éœ€è¦è®¾è®¡å¿«é€Ÿé€šé“
   - è€ƒè™‘æ‰¹é‡å®¡æ‰¹åŠŸèƒ½

## 9. å…·ä½“å®æ–½å»ºè®®

### 9.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„å‡çº§

**æ•°æ®åº“æ”¹è¿›ï¼š**
```sql
-- åˆ›å»ºV8è¿ç§»æ–‡ä»¶
-- V8__Upgrade_Weekly_Reports_For_Three_Tier_Approval.sql

-- 1. æ·»åŠ AIåˆ†æå­—æ®µ
ALTER TABLE weekly_reports 
ADD COLUMN ai_analysis_result TEXT,
ADD COLUMN ai_confidence DECIMAL(3,2),
ADD COLUMN ai_quality_score DECIMAL(3,2),
ADD COLUMN ai_risk_level VARCHAR(20),
ADD COLUMN ai_provider_used VARCHAR(50),
ADD COLUMN ai_processing_time_ms BIGINT,
ADD COLUMN ai_analyzed_at TIMESTAMP,
ADD COLUMN ai_key_issues JSON,
ADD COLUMN ai_recommendations JSON;

-- 2. æ·»åŠ ä¸‰çº§å®¡æ‰¹å­—æ®µ
ALTER TABLE weekly_reports
ADD COLUMN manager_reviewer_id BIGINT,
ADD COLUMN manager_review_comment TEXT,
ADD COLUMN manager_reviewed_at TIMESTAMP,
ADD COLUMN super_admin_reviewer_id BIGINT,
ADD COLUMN super_admin_review_comment TEXT,
ADD COLUMN super_admin_reviewed_at TIMESTAMP;

-- 3. é‡å‘½åç°æœ‰å­—æ®µ
ALTER TABLE weekly_reports 
CHANGE COLUMN reviewer_id admin_reviewer_id BIGINT,
CHANGE COLUMN review_comment admin_review_comment TEXT,
CHANGE COLUMN reviewed_at admin_reviewed_at TIMESTAMP;
```

**å®ä½“ç±»æ‰©å±•ï¼š**
```java
// WeeklyReport.java æ·»åŠ å­—æ®µ
private String aiAnalysisResult;
private Double aiConfidence;
private Double aiQualityScore;
private String aiRiskLevel;
private String aiProviderUsed;
private Long aiProcessingTimeMs;
private LocalDateTime aiAnalyzedAt;
private String aiKeyIssues;
private String aiRecommendations;

// ä¸‰çº§å®¡æ‰¹å­—æ®µ
@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "manager_reviewer_id")
private User managerReviewer;
private String managerReviewComment;
private LocalDateTime managerReviewedAt;

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "admin_reviewer_id")
private User adminReviewer;
private String adminReviewComment;
private LocalDateTime adminReviewedAt;

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "super_admin_reviewer_id")
private User superAdminReviewer;
private String superAdminReviewComment;
private LocalDateTime superAdminReviewedAt;
```

### 9.2 ç¬¬äºŒé˜¶æ®µï¼šæœåŠ¡å±‚æ”¹è¿›

**AIåˆ†ææœåŠ¡é›†æˆï¼š**
```java
// WeeklyReportService.java
public void triggerAIAnalysis(WeeklyReport report) {
    try {
        StandardizedAIResponse aiResponse = enhancedAIAnalysisService
            .analyzeWeeklyReportQuality(report.getId(), report.getAuthor().getId());
        
        report.setAiAnalysisResult(aiResponse.getProposal());
        report.setAiConfidence(aiResponse.getConfidence());
        report.setAiQualityScore(aiResponse.getConfidence());
        
        if (aiResponse.getIsPass()) {
            report.setStatus(ReportStatus.PENDING_MGR_REVIEW);
        } else {
            report.setStatus(ReportStatus.AI_REJECTED);
        }
        
        weeklyReportRepository.save(report);
    } catch (Exception e) {
        report.setStatus(ReportStatus.AI_REJECTED);
        report.setAiAnalysisResult("AIåˆ†æå¤±è´¥: " + e.getMessage());
        weeklyReportRepository.save(report);
    }
}
```

**ä¸‰çº§å®¡æ‰¹æ–¹æ³•ï¼š**
```java
public void managerReviewReport(Long reportId, User manager, boolean approved, String comment) {
    WeeklyReport report = findReportById(reportId);
    
    if (approved) {
        report.managerApprove(manager, comment);
        report.setStatus(ReportStatus.PENDING_ADMIN_REVIEW);
    } else {
        report.managerReject(manager, comment);
        report.setStatus(ReportStatus.MANAGER_REJECTED);
    }
    
    weeklyReportRepository.save(report);
}
```

### 9.3 ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯ç•Œé¢æ”¹è¿›

**æ–°å¢ç»„ä»¶éœ€æ±‚ï¼š**

1. **`EditReportView.vue`** - å‘¨æŠ¥ç¼–è¾‘é¡µé¢
2. **`ReportApprovalView.vue`** - å‘¨æŠ¥å®¡æ‰¹ç®¡ç†
3. **å¢å¼ºç°æœ‰ç»„ä»¶** - æ·»åŠ AIåˆ†ææ˜¾ç¤ºå’Œå®¡æ‰¹å†å²

**çŠ¶æ€å¯è§†åŒ–è®¾è®¡ï¼š**
```vue
<!-- å‘¨æŠ¥å®¡æ‰¹è¿›åº¦æ¡ -->
<div class="approval-progress">
  <div class="progress-step completed">
    <span>1</span>
    <span>AIåˆ†æ</span>
    <span>{{ getAIStatus(report) }}</span>
  </div>
  <div class="progress-step active">
    <span>2</span>
    <span>ä¸»ç®¡å®¡æ ¸</span>
    <span>{{ getManagerStatus(report) }}</span>
  </div>
  <div class="progress-step">
    <span>3</span>
    <span>ç®¡ç†å‘˜å®¡æ ¸</span>
    <span>{{ getAdminStatus(report) }}</span>
  </div>
  <div class="progress-step">
    <span>4</span>
    <span>è¶…çº§ç®¡ç†å‘˜å®¡æ ¸</span>
    <span>{{ getSuperAdminStatus(report) }}</span>
  </div>
</div>
```

## 10. æˆæœ¬æ•ˆç›Šåˆ†æ

### 10.1 å¼€å‘æˆæœ¬ä¼°ç®—

| æ”¹è¿›é¡¹ç›® | å¼€å‘æ—¶é—´ | æŠ€æœ¯éš¾åº¦ | ä¸šåŠ¡ä»·å€¼ |
|---------|---------|---------|---------|
| AIåˆ†æé›†æˆ | 5å¤© | ä¸­ç­‰ | é«˜ |
| ä¸‰çº§å®¡æ‰¹ | 3å¤© | ä½ | é«˜ |
| é‡æ–°æäº¤ | 2å¤© | ä½ | ä¸­ |
| å¼ºè¡Œæäº¤ | 1å¤© | ä½ | ä¸­ |
| ç•Œé¢ä¼˜åŒ– | 4å¤© | ä¸­ç­‰ | ä¸­ |
| **æ€»è®¡** | **15å¤©** | **ä¸­ç­‰** | **é«˜** |

### 10.2 ä¸šåŠ¡ä»·å€¼è¯„ä¼°

**ç›´æ¥æ”¶ç›Šï¼š**
- âœ… **è´¨é‡æå‡**: AIåˆ†æç¡®ä¿å‘¨æŠ¥è´¨é‡
- âœ… **æµç¨‹æ ‡å‡†åŒ–**: ä¸é¡¹ç›®å®¡æ‰¹æµç¨‹ä¸€è‡´
- âœ… **å¯è¿½æº¯æ€§**: å®Œæ•´çš„å®¡æ‰¹å†å²è®°å½•
- âœ… **ç”¨æˆ·ä½“éªŒ**: æ”¯æŒä¿®æ”¹å’Œé‡æ–°æäº¤

**é—´æ¥æ”¶ç›Šï¼š**
- âœ… **ç®¡ç†æ•ˆç‡**: è‡ªåŠ¨åŒ–è´¨é‡æ£€æŸ¥
- âœ… **å†³ç­–æ”¯æŒ**: AIåˆ†ææä¾›æ”¹è¿›å»ºè®®
- âœ… **åˆè§„æ€§**: å®Œæ•´çš„å®¡æ‰¹æµç¨‹è®°å½•

## 11. ç»“è®ºå’Œå»ºè®®

### 11.1 æ ¸å¿ƒå»ºè®®

1. **ç«‹å³å®æ–½AIåˆ†æ**: è¿™æ˜¯æœ€æœ‰ä»·å€¼çš„æ”¹è¿›ï¼Œèƒ½æ˜¾è‘—æå‡å‘¨æŠ¥è´¨é‡
2. **åˆ†é˜¶æ®µå®æ–½ä¸‰çº§å®¡æ‰¹**: é¿å…ä¸€æ¬¡æ€§å¤§å¹…æ”¹åŠ¨å½±å“ç”¨æˆ·
3. **ä¿æŒå‘åå…¼å®¹**: åœ¨è¿‡æ¸¡æœŸå†…æ”¯æŒæ—§æ¥å£
4. **ç”¨æˆ·åŸ¹è®­**: æ–°æµç¨‹éœ€è¦é…å¥—çš„ç”¨æˆ·æŒ‡å¯¼

### 11.2 å®æ–½è·¯å¾„

**æ¨èå®æ–½é¡ºåºï¼š**
1. **ç¬¬ä¸€æ­¥**: AIåˆ†æé›†æˆï¼ˆæœ€é«˜ä»·å€¼ï¼‰
2. **ç¬¬äºŒæ­¥**: ä¸‰çº§å®¡æ‰¹å­—æ®µæ‰©å±•
3. **ç¬¬ä¸‰æ­¥**: é‡æ–°æäº¤åŠŸèƒ½
4. **ç¬¬å››æ­¥**: å‰ç«¯ç•Œé¢ä¼˜åŒ–
5. **ç¬¬äº”æ­¥**: å¼ºè¡Œæäº¤å’Œé«˜çº§åŠŸèƒ½

### 11.3 æŠ€æœ¯æ¶æ„å»ºè®®

**éµå¾ªç°æœ‰é¡¹ç›®æ¨¡å¼ï¼š**
- ä½¿ç”¨ç›¸åŒçš„AIåˆ†ææœåŠ¡ï¼ˆEnhancedAIAnalysisServiceï¼‰
- é‡‡ç”¨ç›¸åŒçš„æƒé™æ§åˆ¶æ¨¡å¼ï¼ˆ@PreAuthorizeï¼‰
- ä¿æŒä¸€è‡´çš„å‰ç«¯ç»„ä»¶è®¾è®¡é£æ ¼
- ä½¿ç”¨ç›¸åŒçš„æ•°æ®è„±æ•å’Œå®‰å…¨æªæ–½

**å…³é”®æˆåŠŸå› ç´ ï¼š**
1. **ä¿æŒæ¶æ„ä¸€è‡´æ€§** - ä¸é¡¹ç›®å®¡æ‰¹æµç¨‹è®¾è®¡ä¸€è‡´
2. **åˆ†é˜¶æ®µå®æ–½** - é™ä½é£é™©ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
3. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ** - ç¡®ä¿æ”¹è¿›çœŸæ­£æå‡ç”¨æˆ·æ•ˆç‡
4. **æ•°æ®å®Œæ•´æ€§** - ç¡®ä¿è¿ç§»è¿‡ç¨‹ä¸­æ•°æ®ä¸ä¸¢å¤±

---

**åˆ†ææ—¶é—´**: 2025-09-16  
**åˆ†æèŒƒå›´**: å®Œæ•´çš„å‘¨æŠ¥æäº¤å’Œå®¡æ‰¹æµç¨‹  
**æ”¹è¿›æ–¹å‘**: å¯¹æ ‡é¡¹ç›®å®¡æ‰¹æµç¨‹ï¼Œé›†æˆAIåˆ†æå’Œä¸‰çº§å®¡æ‰¹  
**é¢„æœŸæ•ˆæœ**: æ˜¾è‘—æå‡å‘¨æŠ¥è´¨é‡å’Œå®¡æ‰¹æ•ˆç‡  
**é£é™©ç­‰çº§**: ä¸­ç­‰ï¼ˆä¸»è¦æ˜¯æ•°æ®åº“è¿ç§»é£é™©ï¼‰  
**å»ºè®®ä¼˜å…ˆçº§**: é«˜ï¼ˆAIåˆ†æï¼‰> ä¸­ï¼ˆä¸‰çº§å®¡æ‰¹ï¼‰> ä½ï¼ˆç•Œé¢ä¼˜åŒ–ï¼‰  