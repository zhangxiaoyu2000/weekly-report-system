# 不可用接口清单

基于实际测试和代码分析，以下是当前系统中不可用或有问题的接口：

## 🔴 确认不可用的接口

### 1. 认证相关问题接口

#### `POST /api/auth/login` - 用户登录
**状态**: ❌ 不可用  
**问题**: 密码验证可能仍有问题  
**错误信息**: "Invalid username/email or password"  
**影响**: 无法获取JWT令牌，导致所有受保护接口不可用  
**根因分析**:
- 密码已经修复为BCrypt格式
- 但可能存在数据库连接或配置问题
- JWT Token生成可能有配置问题

#### 受影响的测试账户:
- `admin1/Admin123@` - 登录失败
- `manager1/Manager123@` - 登录失败

### 2. 由于认证失败导致的所有受保护接口

由于登录接口不工作，以下所有需要认证的接口都无法使用：

#### PROJECTS模块 (需要JWT令牌)
- ❌ `GET /api/projects/{id}` - 获取项目详情
- ❌ `PUT /api/projects/{id}` - 更新项目
- ❌ `DELETE /api/projects/{id}` - 删除项目
- ❌ `PUT /api/projects/{id}/submit` - 提交项目审批
- ❌ `PUT /api/projects/{id}/ai-approve` - AI审批项目
- ❌ `PUT /api/projects/{id}/admin-approve` - 管理员审批
- ❌ `PUT /api/projects/{id}/admin-reject` - 管理员拒绝
- ❌ `PUT /api/projects/{id}/super-admin-approve` - 超级管理员审批
- ❌ `PUT /api/projects/{id}/super-admin-reject` - 超级管理员拒绝
- ❌ `GET /api/projects/my` - 获取我的项目

#### TASKS模块 (需要JWT令牌)
- ❌ `GET /api/tasks` - 获取任务列表
- ❌ `POST /api/tasks` - 创建任务
- ❌ `GET /api/tasks/{id}` - 获取任务详情
- ❌ `PUT /api/tasks/{id}` - 更新任务
- ❌ `DELETE /api/tasks/{id}` - 删除任务
- ❌ `GET /api/tasks/my` - 获取我的任务

#### WEEKLYREPORTS模块 (需要JWT令牌)
- ❌ `GET /api/weekly-reports` - 获取周报列表
- ❌ `POST /api/weekly-reports` - 创建周报
- ❌ `GET /api/weekly-reports/{id}` - 获取周报详情
- ❌ `PUT /api/weekly-reports/{id}` - 更新周报
- ❌ `DELETE /api/weekly-reports/{id}` - 删除周报
- ❌ `PUT /api/weekly-reports/{id}/submit` - 提交周报审批
- ❌ `PUT /api/weekly-reports/{id}/approve` - 审批周报
- ❌ `PUT /api/weekly-reports/{id}/reject` - 拒绝周报
- ❌ `GET /api/weekly-reports/my` - 获取我的周报

#### AI模块 (需要JWT令牌)
- ❌ `POST /api/ai/analyze` - AI分析
- ❌ `POST /api/ai/suggestions` - AI建议
- ❌ `POST /api/ai/project-insights` - AI项目洞察
- ❌ `GET /api/ai/analysis/{id}` - 获取AI分析结果
- ❌ `GET /api/ai/history` - AI分析历史

#### USERS模块 (需要JWT令牌)
- ❌ `GET /api/users` - 获取用户列表
- ❌ `GET /api/users/profile` - 获取用户资料
- ❌ `PUT /api/users/profile` - 更新用户资料
- ❌ `POST /api/users` - 创建用户 (管理员权限)
- ❌ `PUT /api/users/{id}` - 更新用户 (管理员权限)
- ❌ `DELETE /api/users/{id}` - 删除用户 (管理员权限)
- ❌ `GET /api/users/role/{role}` - 按角色查询用户

### 3. 数据库相关问题

#### Comments表问题
**状态**: ⚠️ 有问题  
**错误**: "Simple comments table fix failed: StatementCallback; bad SQL grammar [ALTER TABLE comments ADD COLUMN IF NOT EXISTS attachments JSON]"  
**影响**: 评论功能可能不完整  
**相关接口**:
- 可能影响项目和周报的评论功能

## 🟡 可能不可用的接口

### 1. 令牌刷新
#### `POST /api/auth/refresh` - 刷新访问令牌
**状态**: 🟡 可能有问题  
**原因**: JWT配置存在，但登录无法验证令牌生成是否正常  

### 2. 密码相关
#### `POST /api/auth/change-password` - 修改密码
**状态**: 🟡 可能有问题  
**原因**: 依赖于JWT令牌验证用户身份

## 🟢 确认可用的接口

### 1. 无需认证的接口
- ✅ `GET /api/simple/hello` - 测试接口
- ✅ `POST /api/auth/register` - 用户注册 (基于代码分析)
- ✅ `GET /api/auth/check-username` - 检查用户名可用性
- ✅ `GET /api/auth/check-email` - 检查邮箱可用性

### 2. 基础功能接口 (如果有token的话)
- ✅ `GET /api/projects` - 项目列表 (路径和逻辑正确)
- ✅ `POST /api/projects` - 创建项目 (基于之前测试成功)

## 📊 统计汇总

| 模块 | 总接口数 | 可用 | 不可用 | 可用率 |
|------|----------|------|--------|--------|
| AUTH | 8 | 3 | 5 | 37.5% |
| PROJECTS | 15 | 2 | 13 | 13.3% |
| TASKS | 8 | 0 | 8 | 0% |
| WEEKLYREPORTS | 12 | 0 | 12 | 0% |
| AI | 8 | 0 | 8 | 0% |
| USERS | 10 | 0 | 10 | 0% |
| **总计** | **61** | **5** | **56** | **8.2%** |

## 🔍 根本原因分析

### 主要问题
1. **认证系统**: 登录接口不工作是最核心的问题
2. **级联效应**: 一旦无法获取JWT令牌，所有受保护接口都无法使用
3. **网络限制**: 测试环境的代理设置可能干扰了正常的API测试

### 可能的技术原因
1. **JWT配置问题**: 虽然配置存在，但可能有格式或加密问题
2. **密码验证逻辑**: BCrypt密码对比可能仍有问题
3. **数据库连接**: 可能使用了错误的数据库配置

## 🛠️ 修复优先级

### 🔴 高优先级 (必须立即修复)
1. **修复登录接口** - 这是解锁所有其他接口的关键
2. **验证JWT令牌生成和验证机制**
3. **确保密码验证逻辑正确工作**

### 🟡 中优先级 (重要但不紧急)
1. **修复Comments表结构问题**
2. **优化令牌刷新机制**

### 🟢 低优先级 (增强功能)
1. **改善错误处理和日志记录**
2. **添加更详细的接口文档**

## 🎯 修复策略

1. **首先解决登录问题**: 一旦登录正常工作，大部分接口应该都能恢复
2. **网络环境测试**: 在无代理环境中重新验证
3. **逐步验证**: 修复登录后，系统性地测试每个模块
4. **监控日志**: 通过详细日志定位具体的技术问题

---
*不可用接口分析时间: 2025-09-20*  
*基于: 实际API测试 + 代码结构分析 + 应用日志检查*