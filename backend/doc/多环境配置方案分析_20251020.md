# Spring Bootå¤šç¯å¢ƒé…ç½®æ–¹æ¡ˆåˆ†æ

**åˆ†ææ—¶é—´**: 2025-10-20 11:05:00
**åˆ†æèŒƒå›´**: application.ymlå¤šç¯å¢ƒé…ç½®æœ€ä½³å®è·µ
**åˆ†æé‡ç‚¹**: é…ç½®æ–‡ä»¶æ‹†åˆ†ã€ç¯å¢ƒç®¡ç†ã€éƒ¨ç½²çµæ´»æ€§
**å½“å‰ç«¯**: backend

---

## æ‰§è¡Œæ‘˜è¦

å½“å‰é¡¹ç›®ä½¿ç”¨**å•æ–‡ä»¶å¤šProfile**æ–¹å¼ï¼ˆæ‰€æœ‰ç¯å¢ƒé…ç½®åœ¨ä¸€ä¸ªapplication.ymlä¸­ï¼‰ï¼Œè™½ç„¶å¯è¡Œä½†å­˜åœ¨**å¯ç»´æŠ¤æ€§å·®**ã€**é…ç½®å†²çªé£é™©é«˜**ç­‰é—®é¢˜ã€‚åˆ†æäº†ä¸‰ç§ä¸»æµæ–¹æ¡ˆåï¼Œæ¨èé‡‡ç”¨**æ–¹æ¡ˆ2ï¼šå¤šæ–‡ä»¶Profile + ç¯å¢ƒå˜é‡è¦†ç›–**ï¼Œè¿™æ˜¯Spring Bootå®˜æ–¹æ¨èçš„æœ€ä½³å®è·µï¼Œå¯ä»¥å®ç°**é…ç½®æ¸…æ™°åˆ†ç¦»**ã€**æ•æ„Ÿä¿¡æ¯å®‰å…¨**ã€**çµæ´»éƒ¨ç½²**çš„ç›®æ ‡ã€‚

---

## å½“å‰é…ç½®ç°çŠ¶

### æ–‡ä»¶ç»“æ„

```
src/main/resources/
â””â”€â”€ application.yml  (å”¯ä¸€é…ç½®æ–‡ä»¶ï¼Œ15613å­—èŠ‚ï¼Œ519è¡Œ)
```

### Profileå®šä¹‰æ–¹å¼

**å•æ–‡ä»¶å¤šProfile**ï¼ˆä½¿ç”¨YAMLæ–‡æ¡£åˆ†éš”ç¬¦`---`ï¼‰:

```yaml
# é€šç”¨é…ç½®
spring:
  profiles:
    active: dev
  datasource:
    url: jdbc:mysql://localhost:3309/...

---
# Development profile
spring:
  config:
    activate:
      on-profile: dev
  datasource:
    hikari:
      maximum-pool-size: 12

---
# Test profile
spring:
  config:
    activate:
      on-profile: test
  datasource:
    url: jdbc:mysql://localhost:3309/...

---
# Docker profile
spring:
  config:
    activate:
      on-profile: docker
  datasource:
    url: jdbc:mysql://${DB_HOST:mysql}:${DB_PORT:3306}/...

---
# Production profile
spring:
  config:
    activate:
      on-profile: prod
  jpa:
    hibernate:
      ddl-auto: validate
```

### å­˜åœ¨çš„é—®é¢˜

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | å½±å“ |
|------|---------|------|
| **é…ç½®é‡å¤**: å¤šä¸ªProfileé‡å¤å®šä¹‰ç›¸åŒé…ç½® | ğŸŸ¡ ä¸­ | ç»´æŠ¤æˆæœ¬é«˜ï¼Œæ˜“å‡ºé”™ |
| **æ–‡ä»¶è¿‡å¤§**: å•æ–‡ä»¶519è¡Œï¼Œéš¾ä»¥å¿«é€Ÿå®šä½ | ğŸŸ¡ ä¸­ | å¼€å‘ä½“éªŒå·® |
| **é€šç”¨é…ç½®æ±¡æŸ“**: å¼€å‘ç¯å¢ƒé…ç½®æ··åœ¨ä¸»é…ç½®ä¸­ | ğŸŸ¡ ä¸­ | ç”Ÿäº§ç¯å¢ƒå¸¦å…¥ä¸å¿…è¦é…ç½® |
| **ç¯å¢ƒåˆ‡æ¢ä¸ç›´è§‚**: éœ€è¦ä¿®æ”¹ä»£ç æ‰èƒ½åˆ‡æ¢ç¯å¢ƒ | ğŸŸ¢ ä½ | å¯é€šè¿‡ç¯å¢ƒå˜é‡è§£å†³ |
| **ç‰ˆæœ¬æ§åˆ¶å›°éš¾**: æ•æ„Ÿä¿¡æ¯å’Œé€šç”¨é…ç½®æ··åœ¨ä¸€èµ· | ğŸŸ¢ ä½ | éœ€è¦å°å¿ƒcommit |

---

## æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ1: ä¿æŒç°çŠ¶ï¼ˆå•æ–‡ä»¶å¤šProfileï¼‰

#### ç»“æ„
```
src/main/resources/
â””â”€â”€ application.yml  (åŒ…å«æ‰€æœ‰ç¯å¢ƒé…ç½®)
```

#### ä¼˜åŠ¿
- âœ… æ‰€æœ‰é…ç½®é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼Œæ˜“äºæŸ¥çœ‹å…¨è²Œ
- âœ… æ— éœ€åˆ›å»ºæ–°æ–‡ä»¶ï¼Œæ”¹åŠ¨æœ€å°
- âœ… Spring BootåŸç”Ÿæ”¯æŒï¼Œæ— é¢å¤–é…ç½®

#### åŠ£åŠ¿
- âŒ æ–‡ä»¶è¿‡å¤§ï¼ˆ519è¡Œï¼‰ï¼Œéš¾ä»¥ç»´æŠ¤
- âŒ é…ç½®é‡å¤ä¸¥é‡ï¼ˆæ•°æ®åº“è¿æ¥æ± é…ç½®åœ¨å¤šä¸ªProfileä¸­é‡å¤ï¼‰
- âŒ ç¯å¢ƒé…ç½®è€¦åˆï¼Œä¿®æ”¹ä¸€ä¸ªç¯å¢ƒå¯èƒ½å½±å“å…¶ä»–ç¯å¢ƒ
- âŒ ç‰ˆæœ¬æ§åˆ¶å›°éš¾ï¼ˆæœ¬åœ°é…ç½®å’Œç”Ÿäº§é…ç½®æ··åœ¨ä¸€èµ·ï¼‰

#### é€‚ç”¨åœºæ™¯
- ğŸŸ¢ é¡¹ç›®ç®€å•ï¼Œç¯å¢ƒå·®å¼‚å°
- ğŸŸ¢ é…ç½®é¡¹å°‘äº100è¡Œ
- ğŸŸ¢ å›¢é˜Ÿè§„æ¨¡å°ï¼ˆ1-2äººï¼‰

#### å½“å‰é¡¹ç›®è¯„ä¼°
**ä¸æ¨è** - å½“å‰é…ç½®å·²è¶…è¿‡500è¡Œï¼Œç»´æŠ¤æˆæœ¬é«˜

---

### æ–¹æ¡ˆ2: å¤šæ–‡ä»¶Profileï¼ˆæ¨è â­â­â­â­â­ï¼‰

#### ç»“æ„
```
src/main/resources/
â”œâ”€â”€ application.yml              # é€šç”¨é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨ï¼‰
â”œâ”€â”€ application-dev.yml          # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ application-test.yml         # æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ application-docker.yml       # Dockerç¯å¢ƒ
â””â”€â”€ application-prod.yml         # ç”Ÿäº§ç¯å¢ƒ
```

#### é…ç½®ç¤ºä¾‹

**application.yml** (é€šç”¨é…ç½®):
```yaml
server:
  port: 8081
  servlet:
    context-path: /api

spring:
  application:
    name: weekly-report-backend
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}  # ç¯å¢ƒå˜é‡æ§åˆ¶

# JWTé…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨ï¼‰
jwt:
  secret: ${JWT_SECRET:default-dev-secret-key-must-be-changed-in-production}
  access-token-expiration: ${JWT_ACCESS_EXPIRATION:3600000}

# æ—¥å¿—é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨åŸºç¡€é…ç½®ï¼‰
logging:
  file:
    name: logs/weekly-report.log
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
```

**application-dev.yml** (æœ¬åœ°å¼€å‘):
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3309/weekly_report_system?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    username: root
    password: rootpass123
    hikari:
      maximum-pool-size: 12

  jpa:
    show-sql: true
    hibernate:
      ddl-auto: none

# å¼€å‘ç¯å¢ƒè¯¦ç»†æ—¥å¿—
logging:
  level:
    com.weeklyreport: DEBUG
    org.hibernate.SQL: DEBUG
```

**application-test.yml** (æµ‹è¯•æœåŠ¡å™¨):
```yaml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST:23.95.193.155}:${DB_PORT:3309}/${DB_NAME:weekly_report_system}?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:rootpass123}
    hikari:
      maximum-pool-size: 20

  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate  # æµ‹è¯•ç¯å¢ƒéªŒè¯schema

# æµ‹è¯•ç¯å¢ƒé€‚åº¦æ—¥å¿—
logging:
  level:
    com.weeklyreport: INFO
    org.hibernate.SQL: WARN
```

**application-docker.yml** (Dockerå®¹å™¨):
```yaml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST:mysql}:${DB_PORT:3306}/${DB_NAME:weekly_report_system}?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:rootpass123}
    hikari:
      maximum-pool-size: 30

  jpa:
    show-sql: false
    hibernate:
      ddl-auto: none

cors:
  allowed-origins: ${CORS_ORIGINS:http://localhost:3000}
```

**application-prod.yml** (ç”Ÿäº§ç¯å¢ƒ):
```yaml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?useUnicode=true&characterEncoding=UTF-8&useSSL=true&serverTimezone=UTC
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      maximum-pool-size: 50
      leak-detection-threshold: 120000

  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate  # ç”Ÿäº§ç¯å¢ƒä¸¥æ ¼éªŒè¯

# ç”Ÿäº§ç¯å¢ƒæœ€å°‘æ—¥å¿—
logging:
  level:
    com.weeklyreport: WARN
    org.hibernate.SQL: ERROR
```

#### ä¼˜åŠ¿
- âœ… **é…ç½®æ¸…æ™°åˆ†ç¦»**: æ¯ä¸ªç¯å¢ƒç‹¬ç«‹æ–‡ä»¶ï¼Œä¸€ç›®äº†ç„¶
- âœ… **æ— é…ç½®é‡å¤**: é€šç”¨é…ç½®åœ¨application.ymlï¼Œç¯å¢ƒç‰¹å®šé…ç½®åœ¨å„è‡ªæ–‡ä»¶
- âœ… **æ˜“äºç»´æŠ¤**: ä¿®æ”¹æŸä¸ªç¯å¢ƒä¸å½±å“å…¶ä»–ç¯å¢ƒ
- âœ… **ç‰ˆæœ¬æ§åˆ¶å‹å¥½**: å¯ä»¥.gitignoreæœ¬åœ°é…ç½®ï¼Œä¿æŠ¤æ•æ„Ÿä¿¡æ¯
- âœ… **çµæ´»æ¿€æ´»**: é€šè¿‡ç¯å¢ƒå˜é‡`SPRING_PROFILES_ACTIVE`æ§åˆ¶

#### åŠ£åŠ¿
- âš ï¸ éœ€è¦åˆ›å»ºå¤šä¸ªæ–‡ä»¶
- âš ï¸ åˆæ¬¡é…ç½®éœ€è¦è¿ç§»ç°æœ‰é…ç½®

#### é€‚ç”¨åœºæ™¯
- âœ… ä¸­å¤§å‹é¡¹ç›®
- âœ… ç¯å¢ƒå·®å¼‚æ˜æ˜¾ï¼ˆdev/test/prodé…ç½®ä¸åŒï¼‰
- âœ… å›¢é˜Ÿåä½œå¼€å‘
- âœ… éœ€è¦ä¿æŠ¤æ•æ„Ÿä¿¡æ¯

#### å½“å‰é¡¹ç›®è¯„ä¼°
**å¼ºçƒˆæ¨è** â­â­â­â­â­ - ç¬¦åˆå½“å‰é¡¹ç›®æ‰€æœ‰éœ€æ±‚

---

### æ–¹æ¡ˆ3: å¤–éƒ¨é…ç½®æ–‡ä»¶

#### ç»“æ„
```
é¡¹ç›®å¤–éƒ¨ï¼ˆä¸åœ¨ä»£ç åº“ä¸­ï¼‰:
/etc/weekly-report/
â”œâ”€â”€ application-dev.yml
â”œâ”€â”€ application-test.yml
â””â”€â”€ application-prod.yml

ä»£ç åº“ä¸­:
src/main/resources/
â””â”€â”€ application.yml  (æœ€å°åŒ–é€šç”¨é…ç½®)
```

#### å¯åŠ¨æ–¹å¼
```bash
# é€šè¿‡spring.config.locationæŒ‡å®šå¤–éƒ¨é…ç½®
java -jar app.jar --spring.config.location=file:/etc/weekly-report/application-prod.yml
```

#### ä¼˜åŠ¿
- âœ… **å®Œå…¨åˆ†ç¦»**: é…ç½®å®Œå…¨ä¸åœ¨ä»£ç åº“ä¸­
- âœ… **å®‰å…¨æ€§æœ€é«˜**: æ•æ„Ÿä¿¡æ¯ä¸ä¼šè¢«commit
- âœ… **è¿ç»´çµæ´»**: æ— éœ€é‡æ–°æ„å»ºå³å¯ä¿®æ”¹é…ç½®

#### åŠ£åŠ¿
- âŒ **å¤æ‚åº¦é«˜**: éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šç»´æŠ¤é…ç½®æ–‡ä»¶
- âŒ **éƒ¨ç½²éº»çƒ¦**: éœ€è¦ç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨äºæ­£ç¡®è·¯å¾„
- âŒ **è°ƒè¯•å›°éš¾**: é…ç½®é—®é¢˜éš¾ä»¥è¿½è¸ª

#### é€‚ç”¨åœºæ™¯
- ğŸŸ¢ æé«˜å®‰å…¨è¦æ±‚ï¼ˆé‡‘èã€åŒ»ç–—ç­‰ï¼‰
- ğŸŸ¢ å¤šç§Ÿæˆ·SaaSåº”ç”¨
- ğŸŸ¢ é…ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸å¸Œæœ›é‡æ–°æ„å»º

#### å½“å‰é¡¹ç›®è¯„ä¼°
**ä¸æ¨è** - è¿‡äºå¤æ‚ï¼Œä¸é€‚åˆå½“å‰é¡¹ç›®è§„æ¨¡

---

## æ¨èæ–¹æ¡ˆè¯¦ç»†å®æ–½

### æ–¹æ¡ˆé€‰æ‹©: æ–¹æ¡ˆ2ï¼ˆå¤šæ–‡ä»¶Profileï¼‰

**æ¨èç†ç”±**:
1. âœ… Spring Bootå®˜æ–¹æ¨èçš„æœ€ä½³å®è·µ
2. âœ… é…ç½®æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
3. âœ… çµæ´»æ€§å’Œå®‰å…¨æ€§å¹³è¡¡æœ€å¥½
4. âœ… æ”¹é€ æˆæœ¬é€‚ä¸­

---

## å®æ–½æ­¥éª¤

### ç¬¬1æ­¥: åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶

```bash
cd /Volumes/project/Projects/WeeklyReport/backend/src/main/resources

# åˆ›å»ºç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶
touch application-dev.yml
touch application-test.yml
touch application-docker.yml
touch application-prod.yml
```

### ç¬¬2æ­¥: æ‹†åˆ†ç°æœ‰é…ç½®

#### é€šç”¨é…ç½®è¿ç§»åˆ° application.yml

**ä¿ç•™å†…å®¹**:
- serveré…ç½®ï¼ˆportã€context-pathï¼‰
- spring.application.name
- JWTé…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
- æ—¥å¿—åŸºç¡€é…ç½®
- CORSåŸºç¡€é…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
- AIæœåŠ¡é…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰

**ç§»é™¤å†…å®¹**:
- æ‰€æœ‰`---`åˆ†éš”ç¬¦å’ŒProfileé…ç½®å—
- ç¯å¢ƒç‰¹å®šçš„æ•°æ®åº“URL
- ç¯å¢ƒç‰¹å®šçš„æ—¥å¿—çº§åˆ«
- ç¯å¢ƒç‰¹å®šçš„Hikariè¿æ¥æ± é…ç½®

#### ç¯å¢ƒç‰¹å®šé…ç½®è¿ç§»åˆ°å„è‡ªæ–‡ä»¶

**application-dev.yml**:
- æœ¬åœ°å¼€å‘æ•°æ®åº“è¿æ¥ï¼ˆlocalhost:3309ï¼‰
- DEBUGçº§åˆ«æ—¥å¿—
- show-sql: true
- å¼€å‘ç¯å¢ƒHikarié…ç½®

**application-test.yml**:
- æµ‹è¯•æœåŠ¡å™¨æ•°æ®åº“è¿æ¥ï¼ˆ23.95.193.155:3309ï¼‰
- INFOçº§åˆ«æ—¥å¿—
- show-sql: false
- æµ‹è¯•ç¯å¢ƒHikarié…ç½®

**application-docker.yml**:
- Dockerå†…éƒ¨æ•°æ®åº“è¿æ¥ï¼ˆmysql:3306ï¼‰
- WARNçº§åˆ«æ—¥å¿—
- Dockerç¯å¢ƒç‰¹å®šé…ç½®

**application-prod.yml**:
- ç”Ÿäº§æ•°æ®åº“è¿æ¥ï¼ˆå®Œå…¨ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
- ERRORçº§åˆ«æ—¥å¿—
- ä¸¥æ ¼çš„å®‰å…¨é…ç½®

### ç¬¬3æ­¥: å¤‡ä»½ç°æœ‰é…ç½®

```bash
cp application.yml application.yml.backup-20251020
```

### ç¬¬4æ­¥: ç¯å¢ƒå˜é‡é…ç½®

#### Docker Composeé…ç½®

```yaml
# docker-compose.yml
services:
  backend:
    environment:
      SPRING_PROFILES_ACTIVE: docker  # æ¿€æ´»docker profile
      DB_HOST: mysql
      DB_PORT: 3306
      DB_NAME: weekly_report_system
      DB_USERNAME: root
      DB_PASSWORD: rootpass123
      JWT_SECRET: ${JWT_SECRET}
      CORS_ORIGINS: ${CORS_ORIGINS}
```

#### æµ‹è¯•æœåŠ¡å™¨ç¯å¢ƒå˜é‡

```bash
# åœ¨æµ‹è¯•æœåŠ¡å™¨ä¸Šè®¾ç½®ç¯å¢ƒå˜é‡
export SPRING_PROFILES_ACTIVE=test
export DB_HOST=23.95.193.155
export DB_PORT=3309
export JWT_SECRET="MyVerySecureWeeklyReportJwtSigningKeyForHS512AlgorithmMustBe512BitsOrGreater2024!@#$%^&*()_+="
```

#### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# IDEè¿è¡Œé…ç½®æˆ–å‘½ä»¤è¡Œ
export SPRING_PROFILES_ACTIVE=dev
mvn spring-boot:run
```

### ç¬¬5æ­¥: éªŒè¯é…ç½®

```bash
# æœ¬åœ°éªŒè¯
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# DockeréªŒè¯
docker-compose up backend

# æµ‹è¯•æœåŠ¡å™¨éªŒè¯ï¼ˆé€šè¿‡Jenkinsï¼‰
/deploy backend
```

---

## é…ç½®æ–‡ä»¶å†…å®¹æ¨¡æ¿

### application.yml (é€šç”¨é…ç½®)

```yaml
server:
  port: 8081
  servlet:
    context-path: /api

spring:
  application:
    name: weekly-report-backend

  # ç¯å¢ƒæ¿€æ´»ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ï¼‰
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  # Webé…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨ï¼‰
  web:
    resources:
      add-mappings: false

  mvc:
    throw-exception-if-no-handler-found: true
    dispatch-options-request: false

  # æ•°æ®åº“é©±åŠ¨ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨ï¼‰
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver

  # Flywayé…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨ï¼‰
  flyway:
    enabled: false
    baseline-on-migrate: true

  # JPAåŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨ï¼‰
  jpa:
    defer-datasource-initialization: false
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        jdbc:
          time_zone: UTC

  # äº‹åŠ¡é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨ï¼‰
  transaction:
    default-timeout: 45
    rollback-on-commit-failure: true

# JWTé…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
jwt:
  secret: ${JWT_SECRET:MyVerySecureWeeklyReportJwtSigningKeyForHS512AlgorithmMustBe512BitsOrGreater2024!@#$%^&*()_+=}
  access-token-expiration: ${JWT_ACCESS_EXPIRATION:3600000}
  refresh-token-expiration: ${JWT_REFRESH_EXPIRATION:604800000}

# æ—¥å¿—åŸºç¡€é…ç½®
logging:
  file:
    name: logs/weekly-report.log
    max-size: 100MB
    max-history: 10
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  charset:
    console: UTF-8
    file: UTF-8

# CORSé…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
cors:
  allowed-origins: ${CORS_ORIGINS:http://localhost:3000}
  allowed-methods: GET,POST,PUT,DELETE,OPTIONS
  allowed-headers: "*"
  allow-credentials: true

# AIæœåŠ¡é…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
ai:
  enabled: true
  default-provider: deepseek
  deepseek:
    enabled: true
    api-key: ${DEEPSEEK_API_KEY:sk-4613204f1ddc4fcf88894d77be5da3e8}
    base-url: https://api.deepseek.com
    model: deepseek-chat

# Actuatoré…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
```

### application-dev.yml (æœ¬åœ°å¼€å‘)

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3309/weekly_report_system?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&createDatabaseIfNotExist=true
    username: root
    password: rootpass123
    hikari:
      minimum-idle: 3
      maximum-pool-size: 12
      idle-timeout: 180000
      max-lifetime: 900000
      connection-timeout: 15000
      pool-name: WeeklyReportHikariCP-Dev
      connection-test-query: SELECT 1
      auto-commit: false

  jpa:
    show-sql: true
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true

# å¼€å‘ç¯å¢ƒè¯¦ç»†æ—¥å¿—
logging:
  level:
    com.weeklyreport: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    com.zaxxer.hikari: DEBUG
    root: INFO
```

### application-test.yml (æµ‹è¯•æœåŠ¡å™¨)

```yaml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST:23.95.193.155}:${DB_PORT:3309}/${DB_NAME:weekly_report_system}?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:rootpass123}
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      idle-timeout: 300000
      max-lifetime: 1800000
      connection-timeout: 20000
      pool-name: WeeklyReportHikariCP-Test
      connection-test-query: SELECT 1
      auto-commit: false

  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate  # æµ‹è¯•ç¯å¢ƒéªŒè¯schema
    properties:
      hibernate:
        format_sql: false

# æµ‹è¯•ç¯å¢ƒé€‚åº¦æ—¥å¿—
logging:
  level:
    com.weeklyreport: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    com.zaxxer.hikari: WARN
    root: INFO
```

### application-docker.yml (Dockerå®¹å™¨)

```yaml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST:mysql}:${DB_PORT:3306}/${DB_NAME:weekly_report_system}?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&createDatabaseIfNotExist=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:rootpass123}
    hikari:
      minimum-idle: 5
      maximum-pool-size: 30
      idle-timeout: 300000
      max-lifetime: 1800000
      connection-timeout: 20000
      pool-name: WeeklyReportHikariCP-Docker
      connection-test-query: SELECT 1
      auto-commit: false
      data-source-properties:
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
        useServerPrepStmts: true

  jpa:
    show-sql: false
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: false

# Dockerç¯å¢ƒæ—¥å¿—
logging:
  level:
    com.weeklyreport: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    root: INFO
```

### application-prod.yml (ç”Ÿäº§ç¯å¢ƒ)

```yaml
spring:
  datasource:
    url: jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?useUnicode=true&characterEncoding=UTF-8&useSSL=true&serverTimezone=UTC
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      minimum-idle: 10
      maximum-pool-size: 50
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-timeout: 30000
      leak-detection-threshold: 120000
      pool-name: WeeklyReportHikariCP-Prod
      connection-test-query: SELECT 1
      auto-commit: false
      data-source-properties:
        cachePrepStmts: true
        prepStmtCacheSize: 500
        prepStmtCacheSqlLimit: 4096
        useServerPrepStmts: true

  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate  # ç”Ÿäº§ç¯å¢ƒä¸¥æ ¼éªŒè¯
    properties:
      hibernate:
        format_sql: false
        generate_statistics: false

# ç”Ÿäº§ç¯å¢ƒæœ€å°‘æ—¥å¿—
logging:
  level:
    com.weeklyreport: WARN
    org.springframework.security: WARN
    org.hibernate.SQL: ERROR
    root: WARN
```

---

## ç¯å¢ƒæ¿€æ´»æ–¹å¼å¯¹æ¯”

### æ–¹å¼1: ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export SPRING_PROFILES_ACTIVE=test

# å¯åŠ¨åº”ç”¨
java -jar app.jar
```

**ä¼˜åŠ¿**:
- âœ… å®Œå…¨å¤–éƒ¨åŒ–ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
- âœ… Docker/K8så‹å¥½
- âœ… CI/CDé›†æˆç®€å•

### æ–¹å¼2: å‘½ä»¤è¡Œå‚æ•°

```bash
java -jar app.jar --spring.profiles.active=test
```

**ä¼˜åŠ¿**:
- âœ… ä¸´æ—¶æµ‹è¯•æ–¹ä¾¿
- âœ… æ— éœ€è®¾ç½®ç¯å¢ƒå˜é‡

### æ–¹å¼3: application.ymlé»˜è®¤å€¼

```yaml
spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
```

**ä¼˜åŠ¿**:
- âœ… æœ¬åœ°å¼€å‘æ— éœ€é¢å¤–é…ç½®
- âœ… æœ‰é»˜è®¤å€¼é˜²æ­¢å¿˜è®°è®¾ç½®

**æ¨è**: ç»“åˆæ–¹å¼1å’Œæ–¹å¼3ï¼Œç¯å¢ƒå˜é‡ + é»˜è®¤å€¼

---

## æ•æ„Ÿä¿¡æ¯ç®¡ç†

### .gitignoreé…ç½®

```gitignore
# æ•æ„Ÿé…ç½®æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦æœ¬åœ°è¦†ç›–ï¼‰
application-local.yml
application-*.yml.local

# ç¯å¢ƒå˜é‡æ–‡ä»¶
.env
.env.local
.env.production
```

### ç¯å¢ƒå˜é‡æ–‡ä»¶ç¤ºä¾‹

**dev.env** (æœ¬åœ°å¼€å‘):
```bash
SPRING_PROFILES_ACTIVE=dev
DB_USERNAME=root
DB_PASSWORD=rootpass123
JWT_SECRET=dev-secret-key
```

**test.env** (æµ‹è¯•æœåŠ¡å™¨):
```bash
SPRING_PROFILES_ACTIVE=test
DB_HOST=23.95.193.155
DB_PORT=3309
DB_USERNAME=root
DB_PASSWORD=rootpass123
JWT_SECRET=MyVerySecureWeeklyReportJwtSigningKeyForHS512AlgorithmMustBe512BitsOrGreater2024!@#$%^&*()_+=
CORS_ORIGINS=http://23.95.193.155:3003
```

**ä½¿ç”¨æ–¹å¼**:
```bash
# åŠ è½½ç¯å¢ƒå˜é‡
source test.env

# å¯åŠ¨åº”ç”¨
java -jar app.jar
```

---

## éªŒè¯æ¸…å•

### é…ç½®æ‹†åˆ†åéªŒè¯

- [ ] âœ… application.ymlåªåŒ…å«é€šç”¨é…ç½®
- [ ] âœ… æ¯ä¸ªç¯å¢ƒæ–‡ä»¶åŒ…å«ç¯å¢ƒç‰¹å®šé…ç½®
- [ ] âœ… æ— é…ç½®é‡å¤
- [ ] âœ… æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- [ ] âœ… é»˜è®¤Profileè®¾ç½®æ­£ç¡®

### æœ¬åœ°å¼€å‘éªŒè¯

```bash
# éªŒè¯dev profile
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# æ£€æŸ¥æ—¥å¿—çº§åˆ«
curl http://localhost:8081/api/health

# éªŒè¯æ•°æ®åº“è¿æ¥
# æŸ¥çœ‹æ—¥å¿—ä¸­çš„Hikariè¿æ¥æ± é…ç½®
```

### Dockerç¯å¢ƒéªŒè¯

```bash
# éªŒè¯docker profile
docker-compose up backend

# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec weekly-report-backend env | grep SPRING_PROFILES_ACTIVE

# éªŒè¯æ•°æ®åº“è¿æ¥
docker exec weekly-report-backend curl http://localhost:8080/api/health
```

### æµ‹è¯•æœåŠ¡å™¨éªŒè¯

```bash
# é€šè¿‡Jenkinséƒ¨ç½²
/deploy backend

# SSHç™»å½•æ£€æŸ¥
ssh root@23.95.193.155
docker logs weekly-report-backend | grep "The following profiles are active"

# åº”è¯¥çœ‹åˆ°: The following profiles are active: test
```

---

## å¸¸è§é—®é¢˜

### Q1: å¤šä¸ªProfileé…ç½®å†²çªæ€ä¹ˆåŠï¼Ÿ

**ç­”**: Spring Booté…ç½®ä¼˜å…ˆçº§ï¼ˆç”±é«˜åˆ°ä½ï¼‰:
1. å‘½ä»¤è¡Œå‚æ•°
2. ç¯å¢ƒå˜é‡
3. application-{profile}.yml
4. application.yml

**ç¤ºä¾‹**:
```yaml
# application.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 15  # é»˜è®¤å€¼

# application-prod.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 50  # è¦†ç›–ä¸º50

# ç¯å¢ƒå˜é‡
SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE=100  # æœ€ç»ˆä¸º100
```

### Q2: å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼Ÿ

**ç­”**: åœ¨å„ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸­å®šä¹‰:
```yaml
# application-dev.yml
logging:
  level:
    com.weeklyreport: DEBUG

# application-prod.yml
logging:
  level:
    com.weeklyreport: WARN
```

### Q3: Docker Composeå¦‚ä½•æ¿€æ´»ç‰¹å®šProfileï¼Ÿ

**ç­”**: é€šè¿‡ç¯å¢ƒå˜é‡:
```yaml
services:
  backend:
    environment:
      SPRING_PROFILES_ACTIVE: docker
```

### Q4: èƒ½åŒæ—¶æ¿€æ´»å¤šä¸ªProfileå—ï¼Ÿ

**ç­”**: å¯ä»¥ï¼Œä½¿ç”¨é€—å·åˆ†éš”:
```bash
export SPRING_PROFILES_ACTIVE=docker,redis,cache
```

---

## è¿ç§»æˆæœ¬è¯„ä¼°

| ä»»åŠ¡ | å·¥ä½œé‡ | é£é™© |
|------|--------|------|
| åˆ›å»ºæ–°é…ç½®æ–‡ä»¶ | 30åˆ†é’Ÿ | ğŸŸ¢ ä½ |
| æ‹†åˆ†ç°æœ‰é…ç½® | 1-2å°æ—¶ | ğŸŸ¡ ä¸­ |
| éªŒè¯å„ç¯å¢ƒ | 1å°æ—¶ | ğŸŸ¡ ä¸­ |
| æ›´æ–°Docker Compose | 15åˆ†é’Ÿ | ğŸŸ¢ ä½ |
| æ›´æ–°éƒ¨ç½²æ–‡æ¡£ | 30åˆ†é’Ÿ | ğŸŸ¢ ä½ |
| **æ€»è®¡** | **3-4å°æ—¶** | ğŸŸ¡ **ä¸­** |

**é£é™©ç¼“è§£**:
- âœ… å¤‡ä»½ç°æœ‰application.yml
- âœ… åœ¨devç¯å¢ƒå…ˆéªŒè¯
- âœ… å†éƒ¨ç½²åˆ°testç¯å¢ƒ
- âœ… æœ€åè€ƒè™‘prodç¯å¢ƒ

---

## æ€»ç»“

### æ¨èæ–¹æ¡ˆ

**æ–¹æ¡ˆ2: å¤šæ–‡ä»¶Profile + ç¯å¢ƒå˜é‡è¦†ç›–**

**æ ¸å¿ƒé…ç½®ç»“æ„**:
```
src/main/resources/
â”œâ”€â”€ application.yml              # é€šç”¨é…ç½®
â”œâ”€â”€ application-dev.yml          # æœ¬åœ°å¼€å‘
â”œâ”€â”€ application-test.yml         # æµ‹è¯•æœåŠ¡å™¨
â”œâ”€â”€ application-docker.yml       # Dockerå®¹å™¨
â””â”€â”€ application-prod.yml         # ç”Ÿäº§ç¯å¢ƒ
```

**æ¿€æ´»æ–¹å¼**:
```bash
# é€šè¿‡ç¯å¢ƒå˜é‡
export SPRING_PROFILES_ACTIVE=test
java -jar app.jar
```

### æ ¸å¿ƒä¼˜åŠ¿

1. âœ… **æ¸…æ™°åˆ†ç¦»**: æ¯ä¸ªç¯å¢ƒé…ç½®ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°
2. âœ… **æ˜“äºç»´æŠ¤**: ä¿®æ”¹æŸç¯å¢ƒä¸å½±å“å…¶ä»–ç¯å¢ƒ
3. âœ… **å®‰å…¨æ€§å¥½**: æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥
4. âœ… **çµæ´»éƒ¨ç½²**: æ— éœ€ä¿®æ”¹ä»£ç å³å¯åˆ‡æ¢ç¯å¢ƒ
5. âœ… **ç¬¦åˆæœ€ä½³å®è·µ**: Spring Bootå®˜æ–¹æ¨è

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**:
   - å¤‡ä»½ç°æœ‰application.yml
   - åˆ›å»ºæ–°çš„ç¯å¢ƒé…ç½®æ–‡ä»¶
   - æ‹†åˆ†é…ç½®åˆ°å„æ–‡ä»¶

2. **éªŒè¯æµ‹è¯•**:
   - æœ¬åœ°devç¯å¢ƒéªŒè¯
   - Dockerç¯å¢ƒéªŒè¯
   - æµ‹è¯•æœåŠ¡å™¨éªŒè¯

3. **æ–‡æ¡£æ›´æ–°**:
   - æ›´æ–°éƒ¨ç½²æ–‡æ¡£
   - æ›´æ–°ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-10-20 11:30:00
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ†æäººå‘˜**: Claude Code (SuperClaude Framework)
