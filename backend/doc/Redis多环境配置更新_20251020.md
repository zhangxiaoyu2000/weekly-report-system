# Rediså¤šç¯å¢ƒé…ç½®æ›´æ–°è¯´æ˜

**æ›´æ–°æ—¶é—´**: 2025-10-20 17:35:00
**æ›´æ–°å†…å®¹**: Redisé…ç½®æŒ‰ç¯å¢ƒåˆ†ç¦»
**å½±å“èŒƒå›´**: æ‰€æœ‰ç¯å¢ƒé…ç½®æ–‡ä»¶

---

## æ›´æ–°æ¦‚è§ˆ

### é…ç½®è¿ç§»

**è¿ç§»å‰**: Redisé…ç½®åœ¨`application.yml`é€šç”¨é…ç½®ä¸­
```yaml
# application.yml
spring:
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DATABASE:0}
      timeout: ${REDIS_TIMEOUT:2000}
```

**è¿ç§»å**: Redisé…ç½®æŒ‰ç¯å¢ƒç‹¬ç«‹é…ç½®
```
application.yml          â†’ ä¸åŒ…å«Redisé…ç½®
application-dev.yml      â†’ æœ¬åœ°Redisé…ç½®
application-test.yml     â†’ æµ‹è¯•æœåŠ¡å™¨Redisé…ç½®
application-docker.yml   â†’ Dockerå®¹å™¨Redisé…ç½®
application-prod.yml     â†’ ç”Ÿäº§ç¯å¢ƒRedisé…ç½®
```

---

## å„ç¯å¢ƒRedisé…ç½®è¯¦æƒ…

### 1. application-dev.yml (æœ¬åœ°å¼€å‘)

```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
      password:           # æ— å¯†ç 
      database: 0
      timeout: 2000
```

**ç‰¹ç‚¹**:
- âœ… è¿æ¥æœ¬åœ°Rediså®ä¾‹
- âœ… æ— å¯†ç ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- âœ… çŸ­è¶…æ—¶æ—¶é—´ï¼ˆ2ç§’ï¼‰

---

### 2. application-test.yml (æµ‹è¯•æœåŠ¡å™¨)

```yaml
spring:
  data:
    redis:
      host: ${REDIS_HOST:23.95.193.155}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DATABASE:0}
      timeout: ${REDIS_TIMEOUT:3000}
```

**ç‰¹ç‚¹**:
- âœ… é»˜è®¤è¿æ¥æµ‹è¯•æœåŠ¡å™¨Redis (`23.95.193.155`)
- âœ… æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–
- âœ… é€‚åº¦è¶…æ—¶æ—¶é—´ï¼ˆ3ç§’ï¼‰
- âœ… å¯é…ç½®å¯†ç ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡ï¼‰

**ç¯å¢ƒå˜é‡ç¤ºä¾‹**:
```bash
export REDIS_HOST=23.95.193.155
export REDIS_PORT=6379
export REDIS_PASSWORD=test_redis_password
export REDIS_DATABASE=0
```

---

### 3. application-docker.yml (Dockerå®¹å™¨)

```yaml
spring:
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DATABASE:0}
      timeout: ${REDIS_TIMEOUT:3000}
```

**ç‰¹ç‚¹**:
- âœ… é»˜è®¤ä½¿ç”¨Docker ComposeæœåŠ¡å (`redis`)
- âœ… å®¹å™¨å†…éƒ¨ç½‘ç»œé€šä¿¡
- âœ… æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–
- âœ… é€‚åº¦è¶…æ—¶æ—¶é—´ï¼ˆ3ç§’ï¼‰

**Docker Composeé…ç½®**:
```yaml
services:
  backend:
    environment:
      REDIS_HOST: redis  # DockeræœåŠ¡å
      REDIS_PORT: 6379
      REDIS_PASSWORD: docker_redis_password

  redis:
    image: redis:7-alpine
    container_name: weekly-report-redis
    ports:
      - "6379:6379"
    command: redis-server --requirepass docker_redis_password
```

---

### 4. application-prod.yml (ç”Ÿäº§ç¯å¢ƒ)

```yaml
spring:
  data:
    redis:
      host: ${REDIS_HOST}              # å¿…é¡»é…ç½®ï¼Œæ— é»˜è®¤å€¼
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD}       # å¿…é¡»é…ç½®ï¼Œæ— é»˜è®¤å€¼
      database: ${REDIS_DATABASE:0}
      timeout: ${REDIS_TIMEOUT:5000}
      # ç”Ÿäº§ç¯å¢ƒè¿æ¥æ± é…ç½®
      lettuce:
        pool:
          max-active: 20    # æœ€å¤§æ´»è·ƒè¿æ¥
          max-idle: 10      # æœ€å¤§ç©ºé—²è¿æ¥
          min-idle: 5       # æœ€å°ç©ºé—²è¿æ¥
          max-wait: 3000    # æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
```

**ç‰¹ç‚¹**:
- ğŸ”´ **å¿…é¡»é…ç½®ç¯å¢ƒå˜é‡**ï¼ˆ`REDIS_HOST`å’Œ`REDIS_PASSWORD`æ— é»˜è®¤å€¼ï¼‰
- âœ… æ›´é•¿è¶…æ—¶æ—¶é—´ï¼ˆ5ç§’ï¼‰
- âœ… è¿æ¥æ± ä¼˜åŒ–é…ç½®
- âœ… é«˜å¯ç”¨æ€§å’Œæ€§èƒ½

**ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆå¿…å¡«ï¼‰**:
```bash
export REDIS_HOST=prod-redis-cluster.example.com
export REDIS_PORT=6379
export REDIS_PASSWORD=secure_production_password
export REDIS_DATABASE=0
export REDIS_TIMEOUT=5000
```

---

## é…ç½®å¯¹æ¯”è¡¨

| ç¯å¢ƒ | Hosté»˜è®¤å€¼ | å¯†ç é»˜è®¤å€¼ | è¶…æ—¶æ—¶é—´ | è¿æ¥æ± é…ç½® | ç¯å¢ƒå˜é‡è¦æ±‚ |
|------|-----------|-----------|---------|-----------|------------|
| **dev** | localhost | (ç©º) | 2000ms | æ—  | å¯é€‰ |
| **test** | 23.95.193.155 | (ç©º) | 3000ms | æ—  | æ¨è |
| **docker** | redis | (ç©º) | 3000ms | æ—  | æ¨è |
| **prod** | (æ— ) | (æ— ) | 5000ms | âœ… å¯ç”¨ | **å¿…é¡»** |

---

## ç¯å¢ƒå˜é‡é…ç½®æŒ‡å—

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# é€šå¸¸ä¸éœ€è¦è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®å³å¯
# å¦‚éœ€è¿æ¥å…¶ä»–Rediså®ä¾‹ï¼š
export REDIS_HOST=localhost
export REDIS_PORT=6379
```

### æµ‹è¯•æœåŠ¡å™¨ç¯å¢ƒ

```bash
# æ¨èé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
export SPRING_PROFILES_ACTIVE=test
export REDIS_HOST=23.95.193.155
export REDIS_PORT=6379
export REDIS_PASSWORD=test_password
export REDIS_DATABASE=0
```

### Dockerç¯å¢ƒ

**docker-compose.ymlé…ç½®**:
```yaml
version: '3.8'

services:
  redis:
    image: redis:7-alpine
    container_name: weekly-report-redis
    ports:
      - "6379:6379"
    command: redis-server --requirepass redis_password
    networks:
      - backend-network

  backend:
    environment:
      SPRING_PROFILES_ACTIVE: docker
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: redis_password
      REDIS_DATABASE: 0
    depends_on:
      - redis
    networks:
      - backend-network

networks:
  backend-network:
    driver: bridge
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# æ‰€æœ‰ç¯å¢ƒå˜é‡å¿…é¡»é…ç½®
export SPRING_PROFILES_ACTIVE=prod
export REDIS_HOST=prod-redis-cluster.example.com
export REDIS_PORT=6379
export REDIS_PASSWORD=very_secure_production_password
export REDIS_DATABASE=0
export REDIS_TIMEOUT=5000
```

---

## éªŒè¯æ–¹æ³•

### 1. æ£€æŸ¥Redisé…ç½®åŠ è½½

```bash
# å¯åŠ¨åº”ç”¨å¹¶æŸ¥çœ‹æ—¥å¿—
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# æŸ¥çœ‹Redisè¿æ¥æ—¥å¿—ï¼ˆå¦‚æœå¯ç”¨äº†è¿æ¥æ—¥å¿—ï¼‰
# åº”è¯¥æ˜¾ç¤ºè¿æ¥åˆ° localhost:6379
```

### 2. æµ‹è¯•Redisè¿æ¥

**æ–¹æ³•1: ä½¿ç”¨Actuatorå¥åº·æ£€æŸ¥**
```bash
curl http://localhost:8081/api/actuator/health

# æœŸæœ›è¾“å‡ºåŒ…å«Rediså¥åº·çŠ¶æ€
{
  "status": "UP",
  "components": {
    "redis": {
      "status": "UP",
      "details": {
        "version": "7.0.0"
      }
    }
  }
}
```

**æ–¹æ³•2: ä½¿ç”¨Redis CLIéªŒè¯**
```bash
# æœ¬åœ°å¼€å‘ç¯å¢ƒ
redis-cli -h localhost -p 6379 ping
# æœŸæœ›è¾“å‡º: PONG

# æµ‹è¯•æœåŠ¡å™¨ç¯å¢ƒ
redis-cli -h 23.95.193.155 -p 6379 -a test_password ping
# æœŸæœ›è¾“å‡º: PONG
```

---

## è¿ç§»æ£€æŸ¥æ¸…å•

### âœ… å®Œæˆçš„æ›´æ–°

- [x] ä»`application.yml`ç§»é™¤Redisé…ç½®
- [x] æ·»åŠ Redisé…ç½®åˆ°`application-dev.yml`
- [x] æ·»åŠ Redisé…ç½®åˆ°`application-test.yml`
- [x] æ·»åŠ Redisé…ç½®åˆ°`application-docker.yml`
- [x] æ·»åŠ Redisé…ç½®åˆ°`application-prod.yml`
- [x] ç”Ÿäº§ç¯å¢ƒé…ç½®è¿æ¥æ± ä¼˜åŒ–

### ğŸ“‹ å¾…æ‰§è¡Œçš„éªŒè¯

- [ ] æœ¬åœ°devç¯å¢ƒéªŒè¯Redisè¿æ¥
- [ ] æµ‹è¯•æœåŠ¡å™¨éªŒè¯Redisé…ç½®
- [ ] Dockerç¯å¢ƒéªŒè¯RedisæœåŠ¡äº’è”
- [ ] æ›´æ–°Docker Composeé…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ›´æ–°éƒ¨ç½²æ–‡æ¡£

---

## Docker Compose Redisé›†æˆ

### å®Œæ•´çš„docker-compose.ymlé…ç½®

```yaml
version: '3.8'

services:
  # MySQL Database
  mysql:
    image: mysql:8.0
    container_name: weekly-report-backend-mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpass123
      MYSQL_DATABASE: weekly_report_system
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - backend-network

  # Redis Cache
  redis:
    image: redis:7-alpine
    container_name: weekly-report-redis
    ports:
      - "6379:6379"
    command: redis-server --requirepass redis_password
    volumes:
      - redis_data:/data
    networks:
      - backend-network
    restart: unless-stopped

  # Backend Application
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: weekly-report-backend
    environment:
      SPRING_PROFILES_ACTIVE: docker
      # Database
      DB_HOST: mysql
      DB_PORT: 3306
      DB_NAME: weekly_report_system
      DB_USERNAME: root
      DB_PASSWORD: rootpass123
      # Redis
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: redis_password
      REDIS_DATABASE: 0
      # JWT
      JWT_SECRET: ${JWT_SECRET}
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis
    networks:
      - backend-network

volumes:
  mysql_data:
    driver: local
  redis_data:
    driver: local

networks:
  backend-network:
    driver: bridge
```

---

## å¸¸è§é—®é¢˜

### Q1: Redisé…ç½®ä»application.ymlç§»é™¤åï¼Œä¼šå½±å“ç°æœ‰ç¯å¢ƒå—ï¼Ÿ

**ç­”**: ä¸ä¼šã€‚
- å„ç¯å¢ƒé…ç½®æ–‡ä»¶å·²åŒ…å«Redisé…ç½®
- é€šè¿‡`SPRING_PROFILES_ACTIVE`æ¿€æ´»å¯¹åº”ç¯å¢ƒ
- é…ç½®ä¼šæ­£ç¡®åŠ è½½

### Q2: ç”Ÿäº§ç¯å¢ƒä¸ºä»€ä¹ˆæ²¡æœ‰é»˜è®¤å€¼ï¼Ÿ

**ç­”**: å®‰å…¨è€ƒè™‘ã€‚
- å¼ºåˆ¶é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
- é¿å…ä½¿ç”¨ä¸å®‰å…¨çš„é»˜è®¤å€¼
- é˜²æ­¢è¯¯ç”¨å¼€å‘ç¯å¢ƒé…ç½®

### Q3: å¦‚ä½•éªŒè¯å½“å‰ä½¿ç”¨çš„Redisé…ç½®ï¼Ÿ

**ç­”**: æŸ¥çœ‹å¯åŠ¨æ—¥å¿—æˆ–Actuatorç«¯ç‚¹ã€‚
```bash
# æ–¹æ³•1: æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
# æ—¥å¿—ä¼šæ˜¾ç¤º: "Lettuce pool statistics" æˆ– Redisè¿æ¥ä¿¡æ¯

# æ–¹æ³•2: ä½¿ç”¨Actuator
curl http://localhost:8081/api/actuator/health
```

### Q4: æµ‹è¯•æœåŠ¡å™¨ä¸ŠRedisåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”**: é»˜è®¤é…ç½®ä¸º`23.95.193.155:6379`
- å¯é€šè¿‡ç¯å¢ƒå˜é‡`REDIS_HOST`è¦†ç›–
- å¦‚Redisä¸åç«¯åœ¨åŒä¸€æœåŠ¡å™¨ï¼Œå¯è®¾ç½®ä¸º`localhost`

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç”Ÿäº§ç¯å¢ƒè¿æ¥æ± é…ç½®ï¼ˆå·²åº”ç”¨ï¼‰

```yaml
spring:
  data:
    redis:
      lettuce:
        pool:
          max-active: 20  # æ ¹æ®å¹¶å‘é‡è°ƒæ•´
          max-idle: 10
          min-idle: 5
          max-wait: 3000
```

**è°ƒä¼˜æŒ‡å—**:
- **é«˜å¹¶å‘åœºæ™¯**: å¢åŠ `max-active`åˆ°50-100
- **ä½å¹¶å‘åœºæ™¯**: å‡å°‘åˆ°10-20èŠ‚çœèµ„æº
- **é¢‘ç¹è®¿é—®**: å¢åŠ `min-idle`ä¿æŒè¿æ¥æ± é¢„çƒ­
- **å¶å°”è®¿é—®**: å‡å°‘`min-idle`èŠ‚çœèµ„æº

### å¼€å‘/æµ‹è¯•ç¯å¢ƒ

ä¸éœ€è¦è¿æ¥æ± é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å•è¿æ¥å³å¯ã€‚

---

## å®‰å…¨å»ºè®®

### å¯†ç ç®¡ç†

1. **å¼€å‘ç¯å¢ƒ**: å¯ä»¥æ— å¯†ç ï¼ˆä»…æœ¬åœ°è®¿é—®ï¼‰
2. **æµ‹è¯•ç¯å¢ƒ**: å»ºè®®è®¾ç½®å¯†ç 
3. **ç”Ÿäº§ç¯å¢ƒ**: **å¿…é¡»è®¾ç½®å¼ºå¯†ç **

### ç½‘ç»œéš”ç¦»

1. **å¼€å‘ç¯å¢ƒ**: localhostè®¿é—®
2. **Dockerç¯å¢ƒ**: å®¹å™¨å†…éƒ¨ç½‘ç»œ
3. **ç”Ÿäº§ç¯å¢ƒ**: VPCå†…éƒ¨ç½‘ç»œ + è®¿é—®æ§åˆ¶

---

**æ›´æ–°å®Œæˆæ—¶é—´**: 2025-10-20 17:35:00
**éªŒè¯çŠ¶æ€**: é…ç½®å·²æ›´æ–°ï¼Œå¾…éªŒè¯
**ä¸‹ä¸€æ­¥**: éªŒè¯å„ç¯å¢ƒRedisè¿æ¥
