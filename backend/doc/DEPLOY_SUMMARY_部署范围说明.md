# éƒ¨ç½²å‘½ä»¤èŒƒå›´è¯´æ˜ - å¿«é€Ÿå‚è€ƒ

> ğŸ“… æ›´æ–°æ—¶é—´: 2025-10-20
> ğŸ“‹ è¯¦ç»†åˆ†æ: å‚è§ `deploy_testå‘½ä»¤éƒ¨ç½²èŒƒå›´åˆ†æ_20251020.md`

---

## âš¡ æ ¸å¿ƒè¦ç‚¹

### `/deploy test` å®é™…éƒ¨ç½²èŒƒå›´

```
âœ… éƒ¨ç½²: weekly-report-backend (Spring Bootå®¹å™¨)
ğŸŸ¢ æ£€æŸ¥: weekly-report-backend-mysql (ä¸é‡å¯ï¼Œä»…å¥åº·æ£€æŸ¥)
ğŸš« ä¸æ¶‰åŠ: Redisã€Nginxã€å…¶ä»–ä»»ä½•æœåŠ¡
```

---

## ğŸ¯ å‘½ä»¤å‚æ•°è§£æ

### `/deploy` å‘½ä»¤è®¾è®¡

```bash
/deploy [backend|frontend|all] [--force]
```

| å‚æ•° | å®é™…è¡Œä¸º |
|------|---------|
| `backend` | éƒ¨ç½²åç«¯ âœ… |
| `frontend` | éƒ¨ç½²å‰ç«¯ âœ… |
| `all` | éƒ¨ç½²åç«¯+å‰ç«¯ âœ… |
| `test` | **é»˜è®¤è¡Œä¸º** â†’ éƒ¨ç½²åç«¯ âš ï¸ |
| (å…¶ä»–ä»»æ„å€¼) | **é»˜è®¤è¡Œä¸º** â†’ éƒ¨ç½²åç«¯ âš ï¸ |
| (æœªæŒ‡å®š) | éƒ¨ç½²åç«¯ âœ… |

**âš ï¸ é‡è¦**: `test`ä¸æ˜¯ç¯å¢ƒå‚æ•°ï¼Œè€Œæ˜¯éƒ¨ç½²ç›®æ ‡å‚æ•°ï¼Œä¼šè¢«å½“ä½œæ— æ•ˆå€¼å¤„ç†ï¼Œè§¦å‘é»˜è®¤éƒ¨ç½²åç«¯è¡Œä¸ºã€‚

---

## ğŸ” MySQLå®¹å™¨å¤„ç†æœºåˆ¶

### Docker Composeå¹‚ç­‰æ€§

**Jenkinsæ‰§è¡Œçš„å‘½ä»¤**:
```bash
docker-compose up -d mysql     # æ£€æŸ¥å¹¶ç¡®ä¿MySQLè¿è¡Œ
docker-compose up --build -d backend  # ä»…é‡å»ºåç«¯
```

**æµ‹è¯•æœåŠ¡å™¨åœºæ™¯**:
```
å½“å‰çŠ¶æ€: weekly-report-backend-mysql å®¹å™¨å·²è¿è¡Œ
Jenkinsæ‰§è¡Œ: docker-compose up -d mysql
Dockeræ£€æµ‹: å®¹å™¨å·²è¿è¡Œä¸”é…ç½®æœªå˜
æ‰§è¡Œç»“æœ: âœ… ä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥è·³è¿‡
è¾“å‡ºæ—¥å¿—: weekly-report-backend-mysql is up-to-date
```

### å…³é”®åŸç†

1. **`docker-compose up -d mysql` æ˜¯å¹‚ç­‰æ“ä½œ**
   - å®¹å™¨è¿è¡Œä¸­ â†’ ä¸åšä»»ä½•æ“ä½œ
   - å®¹å™¨å·²åœæ­¢ â†’ å¯åŠ¨å®¹å™¨
   - å®¹å™¨ä¸å­˜åœ¨ â†’ åˆ›å»ºå¹¶å¯åŠ¨

2. **ä¸ä¼šè§¦å‘é‡å¯çš„åŸå› **
   - âœ… æ—  `--force-recreate` å¼ºåˆ¶é‡å»ºæ ‡å¿—
   - âœ… docker-compose.ymlé…ç½®æœªå˜æ›´
   - âœ… Docker Composeä¼˜å…ˆä¿æŒç°æœ‰çŠ¶æ€

3. **æµ‹è¯•æœåŠ¡å™¨æ•°æ®å®Œå…¨å®‰å…¨**
   - âœ… MySQLå®¹å™¨ä¸ä¼šé‡å¯
   - âœ… æ•°æ®åº“è¿æ¥ä¸ä¼šä¸­æ–­
   - âœ… ç°æœ‰æ•°æ®ä¸å—å½±å“

---

## ğŸ“¦ å®é™…éƒ¨ç½²æµç¨‹

### Jenkins Pipelineé˜¶æ®µ

```
1ï¸âƒ£ Environment Setup
   â””â”€ docker-compose down (åœæ­¢æ‰€æœ‰å®¹å™¨)

2ï¸âƒ£ Database Preparation
   â”œâ”€ docker-compose up -d mysql (å¹‚ç­‰æ£€æŸ¥)
   â””â”€ ç­‰å¾…MySQLå¥åº·æ£€æŸ¥é€šè¿‡

3ï¸âƒ£ Backend Build & Deploy
   â”œâ”€ docker-compose up --build -d backend (ä»…é‡å»ºåç«¯)
   â””â”€ ç­‰å¾…åç«¯æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡

4ï¸âƒ£ Health Check
   â”œâ”€ æµ‹è¯• http://23.95.193.155:8082/api/health
   â””â”€ æµ‹è¯•ç™»å½•API

5ï¸âƒ£ Integration Test
   â””â”€ éªŒè¯åç«¯APIå’Œæ•°æ®åº“è¿æ¥
```

### æ¶‰åŠçš„æœåŠ¡å’Œå½±å“

| æœåŠ¡ | æ“ä½œ | å½±å“ |
|------|------|------|
| **weekly-report-backend** | ğŸ”´ é‡æ–°æ„å»º+é‡å¯ | æœåŠ¡ä¸­æ–­30-60ç§’ |
| **weekly-report-backend-mysql** | ğŸŸ¢ å¥åº·æ£€æŸ¥ | **æ— å½±å“** |
| **Redis** | ğŸŸ¢ ä¸æ¶‰åŠ | **æ— å½±å“** |
| **Nginx** | ğŸŸ¢ ä¸æ¶‰åŠ | **æ— å½±å“** |
| **å…¶ä»–æœåŠ¡** | ğŸŸ¢ ä¸æ¶‰åŠ | **æ— å½±å“** |

---

## ğŸŒ ç¯å¢ƒé…ç½®è¯´æ˜

### éƒ¨ç½²ç›®æ ‡ vs è¿è¡Œç¯å¢ƒ

**éƒ¨ç½²ç›®æ ‡**ï¼ˆé€šè¿‡`/deploy`å‚æ•°æ§åˆ¶ï¼‰:
- å†³å®š**å“ªä¸ªåº”ç”¨**è¢«éƒ¨ç½²
- å¯é€‰å€¼: `backend` | `frontend` | `all`

**è¿è¡Œç¯å¢ƒ**ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ï¼‰:
- å†³å®šåº”ç”¨ä»¥**ä»€ä¹ˆé…ç½®**è¿è¡Œ
- åç«¯: `SPRING_PROFILES_ACTIVE=dev|test|docker|prod`
- å‰ç«¯: `VITE_ENV=development|production`

### éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒçš„æ­£ç¡®æ–¹å¼

âŒ **é”™è¯¯ç†è§£**:
```bash
/deploy test  # è¿™ä¸ä¼šéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒï¼
```

âœ… **æ­£ç¡®æ–¹å¼**:
```bash
# æ­¥éª¤1: ä¿®æ”¹ docker-compose.yml æˆ–æµ‹è¯•æœåŠ¡å™¨ç¯å¢ƒå˜é‡
environment:
  SPRING_PROFILES_ACTIVE: test  # ä¿®æ”¹ä¸ºtestç¯å¢ƒ

# æ­¥éª¤2: æ‰§è¡Œéƒ¨ç½²
/deploy backend  # æˆ– /deployï¼ˆæ•ˆæœç›¸åŒï¼‰
```

---

## ğŸ“‹ å¸¸è§é—®é¢˜

### Q1: `/deploy test` ä¼šé‡å¯MySQLå—ï¼Ÿ

**ç­”**: ä¸ä¼šã€‚
- Jenkinsæ‰§è¡Œ`docker-compose up -d mysql`ä»…åšå¥åº·æ£€æŸ¥
- æµ‹è¯•æœåŠ¡å™¨MySQLå·²è¿è¡Œï¼ŒDocker Composeæ£€æµ‹åˆ°åç›´æ¥è·³è¿‡
- **æ•°æ®åº“è¿æ¥ä¸ä¼šä¸­æ–­ï¼Œæ•°æ®å®Œå…¨å®‰å…¨**

### Q2: `/deploy test` ä¼šéƒ¨ç½²Rediså—ï¼Ÿ

**ç­”**: ä¸ä¼šã€‚
- `/deploy test`ç­‰ä»·äº`/deploy backend`
- ä»…éƒ¨ç½²`weekly-report-backend`å®¹å™¨
- Rediså®Œå…¨ä¸æ¶‰åŠï¼Œä½¿ç”¨æµ‹è¯•æœåŠ¡å™¨ç°æœ‰å®ä¾‹

### Q3: å¦‚ä½•æŒ‡å®šéƒ¨ç½²åˆ°testç¯å¢ƒï¼Ÿ

**ç­”**: ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œè€Œéå‘½ä»¤å‚æ•°
```bash
# æ–¹å¼1: ä¿®æ”¹docker-compose.yml
environment:
  SPRING_PROFILES_ACTIVE: test

# æ–¹å¼2: å¯åŠ¨å®¹å™¨æ—¶æŒ‡å®š
docker run -e SPRING_PROFILES_ACTIVE=test weekly-report-backend
```

### Q4: `/deploy`å‘½ä»¤å‚æ•°å¦‚ä½•éªŒè¯ï¼Ÿ

**ç­”**: å½“å‰ç¼ºå°‘å‚æ•°éªŒè¯
- ä»»æ„æ— æ•ˆå‚æ•°ï¼ˆå¦‚`test`ã€`prod`ã€`typo`ï¼‰éƒ½ä¼šè§¦å‘é»˜è®¤è¡Œä¸º
- å»ºè®®æ”¹è¿›: æ·»åŠ å‚æ•°éªŒè¯å’Œé”™è¯¯æç¤ºï¼ˆè§è¯¦ç»†åˆ†ææ–‡æ¡£ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨æ“ä½œ

âœ… **å®‰å…¨çš„æ“ä½œ**:
- `/deploy backend` - ä»…éƒ¨ç½²åç«¯
- `/deploy` - ä»…éƒ¨ç½²åç«¯ï¼ˆé»˜è®¤ï¼‰
- `docker-compose up -d mysql` - å¹‚ç­‰æ£€æŸ¥ï¼Œä¸é‡å¯

âŒ **å±é™©çš„æ“ä½œ**ï¼ˆé¿å…ä½¿ç”¨ï¼‰:
- `docker-compose down` - åœæ­¢æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬MySQLï¼‰
- `docker-compose up -d --force-recreate` - å¼ºåˆ¶é‡å»ºæ‰€æœ‰å®¹å™¨
- `docker-compose restart mysql` - å¼ºåˆ¶é‡å¯MySQL

### æ•°æ®å®‰å…¨ä¿éšœ

**Jenkinså½“å‰é…ç½®å·²ç¡®ä¿**:
- âœ… ä¸ä½¿ç”¨ `--force-recreate` æ ‡å¿—
- âœ… MySQLé…ç½®æœªå˜æ›´
- âœ… æ•°æ®æŒä¹…åŒ–åˆ°volume: `mysql_data`
- âœ… å³ä½¿å®¹å™¨é‡å»ºï¼Œæ•°æ®ä¹Ÿä¼šä¿ç•™

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†åˆ†æ**: `deploy_testå‘½ä»¤éƒ¨ç½²èŒƒå›´åˆ†æ_20251020.md`
- **éƒ¨ç½²åŠ©æ‰‹**: `.claude/deploy-helper.md`
- **å·²çŸ¥é—®é¢˜**: `.claude/DEPLOY.md`
- **éƒ¨ç½²å·¥ä½œæµ**: `.claude/workflow/deployment-workflow.md`
- **æ•°æ®åº“ä¸€è‡´æ€§åˆ†æ**: `æ•°æ®åº“ä¸€è‡´æ€§ä¸ç¯å¢ƒé…ç½®åˆ†ææŠ¥å‘Š_20251020.md`

---

**æœ€åæ›´æ–°**: 2025-10-20 11:00:00
**ç»´æŠ¤è€…**: Claude Code (SuperClaude Framework)
