# /sc:analyse - 代码分析命令

## 命令用途

深度分析代码、架构、系统设计等技术问题，仅产出分析文档，不进行任何代码实现。

## 使用场景

- 分析现有代码架构和设计模式
- 评估技术方案的优缺点
- 识别潜在问题和改进机会
- 生成技术调研报告
- 代码质量和性能分析

## 命令格式

```bash
/sc:analyse                    # 默认分析当前项目
/sc:analyse [分析语句]          # 分析指定目标
/sc:analyse [分析语句] [选项]   # 带选项的分析
```

## 参数说明

### 位置参数
- `[分析语句]` - **可选参数**，要分析的内容
  - **省略时**：默认分析整个当前项目（如 web-dashboard、api-server、employee-client）
  - **指定时**：可以是以下任意类型
    - 文件路径: `src/components/Header.tsx`
    - 目录路径: `src/pages/`
    - 功能模块描述: `认证系统`, `WebSocket集成`
    - 技术问题描述: `性能优化`, `安全漏洞`
    - 自然语言: `分析实时通信的性能问题`

### 可选标志
- `--scope [file|module|directory|system]` - 分析范围
  - `file`: 单文件分析
  - `module`: 模块级分析
  - `directory`: 目录级分析
  - `system`: 系统级架构分析

- `--focus [architecture|performance|security|quality]` - 分析重点
  - `architecture`: 架构设计和模式
  - `performance`: 性能瓶颈和优化
  - `security`: 安全漏洞和风险
  - `quality`: 代码质量和可维护性

- `--depth [surface|standard|deep]` - 分析深度
  - `surface`: 快速概览
  - `standard`: 标准深度分析
  - `deep`: 深度详尽分析

- `--output [文档名称]` - 自定义输出文档名称（默认：分析报告_YYYYMMDD_HHMMSS.md）

## 行为规则

### 核心原则
1. **仅分析不实现** - 绝对不修改任何代码文件
2. **中文文档输出** - 所有分析文档必须使用中文
3. **doc目录存储** - 文档保存在当前端根目录的 `doc/` 目录下
4. **自动创建目录** - 如果 `doc/` 目录不存在，自动创建
5. **结构化输出** - 使用清晰的Markdown格式
6. **智能默认** - 无参数时自动分析当前项目全貌

### 默认行为（重要）
当 `/sc:analyse` 不带任何参数时：
- **分析目标**: 当前工作目录的整个项目
- **分析范围**: 自动识别当前端（web-dashboard/api-server/employee-client）
- **分析内容**:
  - 项目架构和目录结构
  - 核心技术栈和依赖
  - 主要功能模块和组件
  - 代码质量和规范
  - 潜在问题和改进建议
- **文档路径**: `[当前端根目录]/doc/[项目名]项目分析报告_[时间戳].md`
- **目录创建**: 如果 `doc/` 目录不存在，自动创建

### 执行流程
1. **确认当前端** - 识别工作目录（web-dashboard/api-server/employee-client）
2. **确定分析目标**
   - 无参数 → 分析整个当前项目（使用默认行为）
   - 有参数 → 解析分析语句，确定具体目标
3. **准备输出目录**
   - 检查 `doc/` 目录是否存在
   - 不存在则使用 `mkdir -p doc/` 创建目录
4. **收集信息** - 使用Read、Grep、Glob等工具收集数据
5. **深度分析** - 基于SuperClaude框架进行结构化分析
6. **生成文档** - 输出中文Markdown文档到 `doc/` 目录
7. **确认完成** - 告知用户文档完整路径和摘要

### 文档结构模板

```markdown
# [分析主题]

**分析时间**: YYYY-MM-DD HH:MM:SS
**分析范围**: [file/module/directory/system]
**分析重点**: [architecture/performance/security/quality]
**当前端**: [web-dashboard/api-server/employee-client]

---

## 执行摘要

[3-5句话总结关键发现和建议]

## 分析目标

[明确说明本次分析的目的和范围]

## 详细分析

### 1. [分析维度1]

[详细分析内容]

### 2. [分析维度2]

[详细分析内容]

### 3. [分析维度3]

[详细分析内容]

## 关键发现

### 优势
- ✅ [优点1]
- ✅ [优点2]

### 问题
- ⚠️ [问题1]
- ⚠️ [问题2]

### 风险
- 🚨 [风险1]
- 🚨 [风险2]

## 改进建议

### 高优先级
1. [建议1] - 预期收益/影响
2. [建议2] - 预期收益/影响

### 中优先级
1. [建议3]
2. [建议4]

### 低优先级
1. [建议5]
2. [建议6]

## 技术债务评估

| 项目 | 严重程度 | 影响范围 | 建议行动 |
|------|---------|---------|---------|
| [债务项1] | 高/中/低 | [范围] | [行动] |

## 架构视图

[如适用，包含架构图描述或组件关系]

## 性能指标

[如适用，包含性能相关数据和分析]

## 安全评估

[如适用，包含安全相关分析]

## 学习要点

[关键技术概念和最佳实践]

## 参考资源

- [相关文档]
- [最佳实践]
- [技术标准]

---

**分析完成时间**: YYYY-MM-DD HH:MM:SS
**文档版本**: v1.0
```

## 使用示例

### 示例0: 默认分析当前项目
```bash
/sc:analyse
```
分析目标: 整个 web-dashboard 项目
输出: `web-dashboard/doc/web-dashboard项目分析报告_20250114_103045.md`

### 示例1: 分析单个组件
```bash
/sc:analyse src/components/Header.tsx --focus quality
```
输出: `web-dashboard/doc/Header组件质量分析_20250114_103045.md`

### 示例2: 分析整个模块
```bash
/sc:analyse src/pages/ --scope directory --focus architecture
```
输出: `web-dashboard/doc/pages模块架构分析_20250114_103045.md`

### 示例3: 自然语言分析语句
```bash
/sc:analyse 分析WebSocket实时通信的性能问题
```
输出: `web-dashboard/doc/WebSocket实时通信性能分析_20250114_103045.md`

### 示例4: 系统级深度分析
```bash
/sc:analyse "认证系统" --scope system --focus security --depth deep
```
输出: `web-dashboard/doc/认证系统安全分析_20250114_103045.md`

### 示例5: 自定义文档名称
```bash
/sc:analyse src/hooks/ --output "React Hooks设计评审"
```
输出: `web-dashboard/doc/React Hooks设计评审.md`

## 工具使用策略

### 信息收集阶段
- **Read**: 读取源代码文件
- **Glob**: 查找匹配模式的文件
- **Grep**: 搜索代码中的模式
- **Bash**: 执行必要的系统命令（如tree、wc等）

### 分析阶段
- **不使用**: Edit, Write（除了最终文档）, NotebookEdit
- **使用**: 所有只读工具和分析工具
- **MCP服务器**:
  - sequential-thinking: 复杂推理和深度分析
  - context7: 获取最佳实践和模式
  - serena: 代码语义理解

### 输出阶段
- **目录准备**: 使用 `mkdir -p doc/` 确保目录存在
- **Write**: 仅用于生成最终分析文档
- **路径**: 始终写入到 `[根目录]/doc/[文档名].md`
- **验证**: 使用 `pwd` 确认当前工作目录

## 质量标准

### 文档质量
- ✅ 100%中文内容（代码片段除外）
- ✅ 结构清晰，层次分明
- ✅ 使用Markdown格式化
- ✅ 包含可执行的建议
- ✅ 基于证据的分析结论

### 分析深度
- ✅ 不仅指出问题，还要解释原因
- ✅ 提供具体的改进路径
- ✅ 评估影响和优先级
- ✅ 结合项目实际情况

### 专业性
- ✅ 使用准确的技术术语
- ✅ 遵循行业最佳实践
- ✅ 客观评估优缺点
- ✅ 避免主观和夸张的表述

## 错误处理

### 常见错误场景
1. **无参数调用** - 自动分析整个当前项目（非错误，默认行为）
2. **找不到分析目标** - 提示用户确认路径或描述
3. **权限不足** - 说明无法访问的文件
4. **分析范围过大** - 建议缩小范围或提高抽象层级
5. **文档写入失败** - 检查目录权限并重试

### 失败恢复策略
- 提供清晰的错误信息
- 建议替代方案
- 保存已完成的分析结果
- 不留下临时文件

## 与其他命令的协同

- **/sc:implement** - 分析完成后的实施阶段
- **/sc:improve** - 基于分析报告进行改进
- **/sc:troubleshoot** - 针对分析发现的问题进行调试
- **/sc:document** - 补充技术文档

## 性能考虑

- 大型项目分析时使用 `--scope` 限制范围
- 深度分析时合理使用 `--depth` 控制详细程度
- 并行使用多个只读工具加速信息收集
- 使用Task代理处理复杂的多步骤分析

## 注意事项

### 绝对禁止的操作
- ❌ 修改任何源代码文件
- ❌ 删除或移动文件
- ❌ 运行可能影响系统的命令
- ❌ 输出非中文文档（代码除外）
- ❌ 将文档保存在非 `doc/` 目录位置

### 必须执行的操作
- ✅ 使用中文撰写所有分析内容
- ✅ 检查并创建 `doc/` 目录（如不存在）
- ✅ 将文档保存在 `[当前端根目录]/doc/` 下
- ✅ 提供可执行的改进建议
- ✅ 基于实际代码进行分析
- ✅ 遵循SuperClaude框架原则

---

**命令版本**: 1.0.0
**最后更新**: 2025-01-14
**维护者**: SuperClaude Framework
